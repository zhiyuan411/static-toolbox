<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼éŸ³è½¯è¾“å…¥æ³•</title>
    <!-- å¼•å…¥Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Font Awesomeå›¾æ ‡åº“ï¼ˆ6.4.0ï¼‰ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- è‡ªå®šä¹‰Tailwindé…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        input: '#f8fafc',
                        candidate: '#e2e8f0',
                        candidateHover: '#cbd5e1',
                        button: '#3b82f6',
                        buttonHover: '#2563eb',
                        info: '#f0f9ff',
                        toggleOn: '#10b981',
                        toggleOff: '#6b7280',
                        specialChar: '#f9fafb',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .candidate-item {
                @apply px-3 py-2 rounded-md cursor-pointer hover:bg-candidateHover transition-colors duration-150;
            }
            .func-btn {
                @apply flex items-center justify-center w-10 h-10 rounded-md bg-button text-white hover:bg-buttonHover transition-colors duration-150 relative;
            }
            .func-btn-tooltip {
                @apply absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10;
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-button/50 focus:outline-none;
            }
            .info-card {
                @apply bg-info border border-blue-100 rounded-lg p-4 mt-6;
            }
            .toggle-btn {
                @apply px-3 py-1.5 rounded-md transition-colors duration-200 text-white flex items-center gap-1;
            }
            .special-char-modal {
                @apply fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg shadow-2xl p-4 w-full max-w-xl z-50;
            }
            .char-category-tab {
                @apply px-3 py-1.5 rounded-t-md cursor-pointer transition-colors duration-200 text-sm;
            }
            .char-item {
                @apply w-10 h-10 flex items-center justify-center rounded-md cursor-pointer hover:bg-gray-200 transition-colors duration-150 text-lg;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4 relative">
    <div class="w-full max-w-2xl bg-white rounded-lg shadow-lg p-6">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800">æ‹¼éŸ³è½¯è¾“å…¥æ³•</h1>
            <p class="text-gray-500 mt-1">è¾“å…¥æ‹¼éŸ³ï¼Œé€‰æ‹©å€™é€‰å­—è¯ï¼Œæ”¯æŒæ•°å­—å¿«æ·é”®(1-9)å’Œç¿»é¡µæ“ä½œ</p>
        </div>

        <!-- è¾“å‡ºæ˜¾ç¤ºåŒº -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">è¾“å…¥ç»“æœ</label>
            <textarea id="outputArea" class="w-full h-32 p-3 border border-gray-300 rounded-md input-focus resize-none" readonly placeholder="é€‰æ‹©çš„å­—è¯ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>

        <!-- æ‹¼éŸ³è¾“å…¥åŒº -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">æ‹¼éŸ³è¾“å…¥</label>
            <input type="text" id="pinyinInput" class="w-full p-3 border border-gray-300 rounded-md input-focus lowercase" placeholder="è¾“å…¥æ‹¼éŸ³ï¼ˆå¦‚ï¼šaiã€abaï¼‰ï¼ŒæŒ‰ç©ºæ ¼é€‰ç¬¬ä¸€ä¸ªå€™é€‰è¯ï¼Œå›è½¦ç›´æ¥è¾“å…¥å½“å‰å†…å®¹" autocomplete="off">
        </div>

        <!-- å€™é€‰è¯åŒºåŸŸ -->
        <div id="candidateArea" class="mb-6 hidden">
            <div class="flex justify-between items-center mb-2">
                <label class="block text-sm font-medium text-gray-700">å€™é€‰å­—è¯</label>
                <span id="pageInfo" class="text-xs text-gray-500">ç¬¬1é¡µ/å…±1é¡µ</span>
            </div>
            <div id="candidateList" class="flex flex-wrap gap-2 bg-candidate p-3 rounded-md min-h-[50px]">
                <!-- å€™é€‰è¯ä¼šåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
        </div>

        <!-- åŠŸèƒ½æŒ‰é’®åŒº -->
        <div class="flex flex-wrap gap-3 justify-center items-center">
            <!-- å¤åˆ¶æŒ‰é’® -->
            <div class="group">
                <button id="copyBtn" class="func-btn" title="å¤åˆ¶è¾“å…¥ç»“æœ">
                    <i class="fas fa-copy text-lg"></i>
                </button>
                <span class="func-btn-tooltip">å¤åˆ¶è¾“å…¥ç»“æœ</span>
            </div>
            <!-- æœç´¢æŒ‰é’® -->
            <div class="group">
                <button id="searchBtn" class="func-btn" title="ç™¾åº¦æœç´¢è¾“å…¥ç»“æœ">
                    <i class="fas fa-search text-lg"></i>
                </button>
                <span class="func-btn-tooltip">ç™¾åº¦æœç´¢è¾“å…¥ç»“æœ</span>
            </div>
            <!-- æ¸…ç©ºæŒ‰é’® -->
            <div class="group">
                <button id="clearBtn" class="func-btn" title="æ¸…ç©ºæ‰€æœ‰å†…å®¹">
                    <i class="fas fa-trash text-lg"></i>
                </button>
                <span class="func-btn-tooltip">æ¸…ç©ºæ‰€æœ‰å†…å®¹</span>
            </div>
            <!-- åˆ é™¤æŒ‰é’® -->
            <div class="group">
                <button id="deleteBtn" class="func-btn" title="åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦">
                    <i class="fas fa-backspace text-lg"></i>
                </button>
                <span class="func-btn-tooltip">åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦</span>
            </div>
            <!-- ä¸Šä¸€é¡µæŒ‰é’® -->
            <div class="group">
                <button id="prevPageBtn" class="func-btn" title="ä¸Šä¸€é¡µå€™é€‰è¯">
                    <i class="fas fa-chevron-left text-lg"></i>
                </button>
                <span class="func-btn-tooltip">ä¸Šä¸€é¡µå€™é€‰è¯</span>
            </div>
            <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
            <div class="group">
                <button id="nextPageBtn" class="func-btn" title="ä¸‹ä¸€é¡µå€™é€‰è¯">
                    <i class="fas fa-chevron-right text-lg"></i>
                </button>
                <span class="func-btn-tooltip">ä¸‹ä¸€é¡µå€™é€‰è¯</span>
            </div>
            <!-- å…¨è§’/åŠè§’åˆ‡æ¢æŒ‰é’® -->
            <div class="group">
                <button id="fullHalfToggle" class="toggle-btn bg-toggleOff" title="åˆ‡æ¢å…¨è§’/åŠè§’ç¬¦å·">
                    <i class="fas fa-exchange-alt text-sm"></i>
                    <span id="toggleText">åŠè§’</span>
                </button>
                <span class="func-btn-tooltip">åˆ‡æ¢å…¨è§’/åŠè§’ç¬¦å·è¾“å…¥</span>
            </div>
            <!-- ç‰¹æ®Šå­—ç¬¦æŒ‰é’®ï¼ˆä¿®å¤å›¾æ ‡ï¼‰ -->
            <div class="group">
                <button id="specialCharBtn" class="func-btn" title="æ‰“å¼€ç‰¹æ®Šå­—ç¬¦é¢æ¿">
                    <i class="fas fa-icons text-lg"></i> <!-- æ›¿æ¢ä¸ºæ”¯æŒçš„å›¾æ ‡ç±» -->
                </button>
                <span class="func-btn-tooltip">æ‰“å¼€ç‰¹æ®Šå­—ç¬¦é€‰æ‹©é¢æ¿</span>
            </div>
        </div>

        <!-- çŠ¶æ€æç¤º -->
        <div id="statusTip" class="mt-4 text-center text-sm text-gray-500 min-h-[20px]">
            åŠ è½½è¯å…¸ä¸­...
        </div>

        <!-- åŠŸèƒ½å’Œå¿«æ·é”®è¯´æ˜åŒºåŸŸ -->
        <div class="info-card">
            <h3 class="text-lg font-semibold text-blue-800 mb-3">ğŸ“– åŠŸèƒ½ä¸å¿«æ·é”®è¯´æ˜</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <!-- åŸºç¡€æ“ä½œ -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">åŸºç¡€è¾“å…¥</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">1-9</kbd>ï¼šé€‰æ‹©å¯¹åº”åºå·çš„å€™é€‰è¯</li>
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">ç©ºæ ¼</kbd>ï¼šå¿«é€Ÿè¾“å…¥ç¬¬ä¸€ä¸ªå€™é€‰è¯</li>
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">Enter</kbd>ï¼šç›´æ¥è¾“å…¥æ‹¼éŸ³æ¡†å†…çš„å†…å®¹</li>
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">Backspace</kbd>ï¼šæ‹¼éŸ³æ¡†ä¸ºç©ºæ—¶åˆ é™¤ç»“æœæœ€åä¸€ä¸ªå­—ç¬¦</li>
                    </ul>
                </div>
                <!-- ç¿»é¡µæ“ä½œ -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">ç¿»é¡µæ“ä½œ</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">PageUp / [ / -</kbd>ï¼šå€™é€‰è¯ä¸Šä¸€é¡µ</li>
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">PageDown / ] / =</kbd>ï¼šå€™é€‰è¯ä¸‹ä¸€é¡µ</li>
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">â† æŒ‰é’®</kbd>ï¼šæ‰‹åŠ¨ç‚¹å‡»ä¸Šä¸€é¡µ</li>
                        <li><kbd class="px-1 py-0.5 bg-gray-200 rounded">â†’ æŒ‰é’®</kbd>ï¼šæ‰‹åŠ¨ç‚¹å‡»ä¸‹ä¸€é¡µ</li>
                    </ul>
                </div>
                <!-- åŠŸèƒ½æŒ‰é’® -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">åŠŸèƒ½æŒ‰é’®</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li><i class="fas fa-copy mr-1"></i> å¤åˆ¶ï¼šå¤åˆ¶ç»“æœåŒºæ‰€æœ‰å†…å®¹</li>
                        <li><i class="fas fa-search mr-1"></i> æœç´¢ï¼šç”¨ç»“æœå†…å®¹æ‰“å¼€ç™¾åº¦æœç´¢</li>
                        <li><i class="fas fa-trash mr-1"></i> æ¸…ç©ºï¼šæ¸…ç©ºæ‰€æœ‰è¾“å…¥å†…å®¹</li>
                        <li><i class="fas fa-backspace mr-1"></i> åˆ é™¤ï¼šåˆ é™¤ç»“æœæœ€åä¸€ä¸ªå­—ç¬¦</li>
                        <li><i class="fas fa-exchange-alt mr-1"></i> å…¨è§’/åŠè§’ï¼šåˆ‡æ¢ç¬¦å·è¾“å…¥æ ¼å¼</li>
                        <li><i class="fas fa-icons mr-1"></i> ç‰¹æ®Šå­—ç¬¦ï¼šæ‰“å¼€å­—ç¬¦é€‰æ‹©é¢æ¿</li>
                    </ul>
                </div>
                <!-- å…¶ä»–è¯´æ˜ -->
                <div>
                    <h4 class="font-medium text-gray-700 mb-2">å…¶ä»–è¯´æ˜</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>æ‹¼éŸ³è¾“å…¥è‡ªåŠ¨è½¬ä¸ºå°å†™ï¼Œæ— éœ€åŒºåˆ†å¤§å°å†™</li>
                        <li>å€™é€‰è¯æœ€å¤šæ¯é¡µæ˜¾ç¤º9ä¸ªï¼Œæ”¯æŒå¤šé¡µç¿»æŸ¥</li>
                        <li>æ— åŒ¹é…æ‹¼éŸ³æ—¶ä¼šæç¤º"æ— åŒ¹é…å­—è¯"</li>
                        <li>å…¨è§’æ¨¡å¼ä¸‹ï¼Œè¾“å…¥çš„ç¬¦å·è‡ªåŠ¨è½¬ä¸ºä¸­æ–‡å…¨è§’ç¬¦å·</li>
                        <li>æ‰€æœ‰æ“ä½œå‡åœ¨æœ¬åœ°å®Œæˆï¼Œæ— æ•°æ®ä¸Šä¼ </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

<!-- é•œåƒæºé“¾æ¥å¡ç‰‡åŒºåŸŸ -->
    <div class="w-full max-w-5xl mt-12 mb-8 px-4">
        <div class="text-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">é•œåƒæºé“¾æ¥</h2>
            <p class="text-gray-500 mt-1">å¸¸ç”¨è½¯ä»¶åŒ…å’Œé•œåƒç«™é“¾æ¥</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Ubuntu å­—ä½“åŒ… -->
            <a href="http://archive.ubuntu.com/ubuntu/pool/main/f/fonts-wqy-microhei/" 
               target="_blank" 
               class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                <div class="flex items-center mb-3">
                    <i class="fas fa-font text-orange-500 text-xl mr-3"></i>
                    <h3 class="font-semibold text-gray-800">Ubuntu å­—ä½“åŒ…</h3>
                </div>
                <p class="text-sm text-gray-600">WQY-MicroHei ä¸­æ–‡å­—ä½“åŒ…ï¼Œé€‚ç”¨äº Ubuntu ç³»ç»Ÿ</p>
            </a>
            
            <!-- Debian Firefox -->
            <a href="https://deb.debian.org/debian/pool/main/f/firefox/" 
               target="_blank" 
               class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                <div class="flex items-center mb-3">
                    <i class="fas fa-globe text-red-500 text-xl mr-3"></i>
                    <h3 class="font-semibold text-gray-800">Debian Firefox</h3>
                </div>
                <p class="text-sm text-gray-600">Debian å®˜æ–¹ä»“åº“ä¸­çš„ Firefox æµè§ˆå™¨è½¯ä»¶åŒ…</p>
            </a>
            
            <!-- Fedora å­—ä½“åŒ… -->
            <a href="https://dl.fedoraproject.org/pub/fedora/linux/releases/43/Everything/x86_64/os/Packages/w/" 
               target="_blank" 
               class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                <div class="flex items-center mb-3">
                    <i class="fas fa-font text-blue-500 text-xl mr-3"></i>
                    <h3 class="font-semibold text-gray-800">Fedora å­—ä½“åŒ…</h3>
                </div>
                <p class="text-sm text-gray-600">Fedora 43 ç³»ç»Ÿä¸­çš„ WQY-MicroHei ä¸­æ–‡å­—ä½“åŒ…</p>
            </a>
            
            <!-- Rocky Linux Firefox -->
            <a href="https://dl.rockylinux.org/pub/rocky/10.1/AppStream/x86_64/os/Packages/f/" 
               target="_blank" 
               class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                <div class="flex items-center mb-3">
                    <i class="fas fa-globe text-green-600 text-xl mr-3"></i>
                    <h3 class="font-semibold text-gray-800">Rocky Linux Firefox</h3>
                </div>
                <p class="text-sm text-gray-600">Rocky Linux 10.1 ä¸­çš„ Firefox æµè§ˆå™¨è½¯ä»¶åŒ…</p>
            </a>
        </div>
        
        <div class="mt-8">
            <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">å›½å†…é•œåƒç«™</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- æ¸…åå¤§å­¦é•œåƒç«™ -->
                <a href="https://mirrors.tuna.tsinghua.edu.cn/" 
                   target="_blank" 
                   class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-graduation-cap text-purple-600 text-xl mr-3"></i>
                        <h3 class="font-semibold text-gray-800">æ¸…åå¤§å­¦é•œåƒç«™</h3>
                    </div>
                    <p class="text-sm text-gray-600">æä¾›å„ç§å¼€æºè½¯ä»¶ã€Linux å‘è¡Œç‰ˆçš„é•œåƒ</p>
                </a>
                
                <!-- ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦é•œåƒç«™ -->
                <a href="https://mirrors.ustc.edu.cn/" 
                   target="_blank" 
                   class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-university text-red-600 text-xl mr-3"></i>
                        <h3 class="font-semibold text-gray-800">ä¸­ç§‘å¤§é•œåƒç«™</h3>
                    </div>
                    <p class="text-sm text-gray-600">ä¸­å›½ç§‘å­¦æŠ€æœ¯å¤§å­¦çš„å¼€æºè½¯ä»¶é•œåƒç«™</p>
                </a>
                
                <!-- è…¾è®¯äº‘é•œåƒç«™ -->
                <a href="https://mirrors.cloud.tencent.com/" 
                   target="_blank" 
                   class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                    <div class="flex items-center mb-3">
                        <i class="fas fa-cloud text-blue-500 text-xl mr-3"></i>
                        <h3 class="font-semibold text-gray-800">è…¾è®¯äº‘é•œåƒç«™</h3>
                    </div>
                    <p class="text-sm text-gray-600">è…¾è®¯äº‘æä¾›çš„å¼€æºè½¯ä»¶é•œåƒæœåŠ¡</p>
                </a>
                
                <!-- é˜¿é‡Œäº‘é•œåƒç«™ -->
                <a href="https://developer.aliyun.com/mirror/" 
                   target="_blank" 
                   class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                    <div class="flex items-center mb-3">
                        <i class="fab fa-alipay text-orange-500 text-xl mr-3"></i>
                        <h3 class="font-semibold text-gray-800">é˜¿é‡Œäº‘é•œåƒç«™</h3>
                    </div>
                    <p class="text-sm text-gray-600">é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºçš„é•œåƒæœåŠ¡</p>
                </a>
            </div>
        </div>
        
        <div class="mt-6 text-center text-sm text-gray-500">
            <p>ç‚¹å‡»ä»¥ä¸Šé“¾æ¥å¯å¿«é€Ÿè®¿é—®ç›¸åº”çš„è½¯ä»¶åŒ…ä»“åº“æˆ–é•œåƒç«™</p>
        </div>
    </div>

    <!-- ç‰¹æ®Šå­—ç¬¦é€‰æ‹©æ‚¬æµ®æ¡†ï¼ˆä¿®å¤z-indexå’Œæ˜¾ç¤ºé€»è¾‘ï¼‰ -->
    <div id="specialCharModal" class="special-char-modal hidden">
        <!-- å…³é—­æŒ‰é’® -->
        <div class="flex justify-between items-center mb-3 border-b pb-2">
            <h3 class="font-semibold text-gray-800">ç‰¹æ®Šå­—ç¬¦é€‰æ‹©</h3>
            <button id="closeSpecialCharBtn" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 transition-colors">
                <i class="fas fa-times text-gray-600"></i>
            </button>
        </div>

        <!-- å­—ç¬¦åˆ†ç±»æ ‡ç­¾ -->
        <div id="charCategoryTabs" class="flex flex-wrap gap-1 mb-3 border-b pb-2 overflow-x-auto">
            <!-- åˆ†ç±»æ ‡ç­¾åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- å­—ç¬¦å±•ç¤ºåŒºåŸŸ -->
        <div id="charDisplayArea" class="grid grid-cols-8 gap-1 max-h-60 overflow-y-auto p-2 bg-specialChar rounded-md">
            <!-- å­—ç¬¦åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- é®ç½©å±‚ï¼ˆä¿®å¤z-indexï¼‰ -->
    <div id="modalOverlay" class="fixed inset-0 bg-black/30 z-40 hidden"></div>

    <script>
        // å…¨å±€å˜é‡
        let pinyinDict = {};
        let half2full = {}; // å…¨è§’åŠè§’æ˜ å°„ï¼ˆä»æ–‡ä»¶åŠ è½½ï¼‰
        let specialChars = {}; // ç‰¹æ®Šå­—ç¬¦åˆ†ç±»ï¼ˆä»æ–‡ä»¶åŠ è½½ï¼‰
        let candidateWords = [];
        let currentPage = 0; // å½“å‰é¡µç ï¼ˆä»0å¼€å§‹ï¼‰
        const pageSize = 9; // æ¯é¡µæ˜¾ç¤º9ä¸ªå€™é€‰è¯ï¼ˆé€‚é…æ•°å­—é”®1-9ï¼‰
        let totalPages = 0; // æ€»é¡µæ•°
        let isFullWidthMode = false; // æ˜¯å¦å¼€å¯å…¨è§’æ¨¡å¼ï¼ˆé»˜è®¤å…³é—­ï¼Œå³åŠè§’æ¨¡å¼ï¼‰
        let currentCharCategory = ''; // å½“å‰é€‰ä¸­çš„å­—ç¬¦åˆ†ç±»
        let initialsDict = {}; // å£°æ¯å­—å…¸
        let prefixDict = {}; // å‰ç¼€å­—å…¸
        let greedyMatched = false; // æ ‡è®°å½“å‰æ˜¯å¦æ˜¯è´ªå¿ƒåŒ¹é…æ¨¡å¼
        
        // å£°æ¯å…ƒæ•°æ®å­—å…¸
        const INITIALS_MAP = {
            'b': 'b', 'p': 'p', 'm': 'm', 'f': 'f', 'd': 'd', 't': 't', 'n': 'n', 'l': 'l',
            'g': 'g', 'k': 'k', 'h': 'h', 'j': 'j', 'q': 'q', 'x': 'x',
            'zh': 'zh', 'ch': 'ch', 'sh': 'sh', 'r': 'r',
            'z': 'z', 'c': 'c', 's': 's', 'y': 'y', 'w': 'w'
        };

        // DOMå…ƒç´ ï¼ˆæå‰ç¼“å­˜ï¼Œé¿å…é‡å¤è·å–ï¼‰
        const dom = {
            pinyinInput: document.getElementById('pinyinInput'),
            outputArea: document.getElementById('outputArea'),
            candidateArea: document.getElementById('candidateArea'),
            candidateList: document.getElementById('candidateList'),
            pageInfo: document.getElementById('pageInfo'),
            copyBtn: document.getElementById('copyBtn'),
            searchBtn: document.getElementById('searchBtn'),
            clearBtn: document.getElementById('clearBtn'),
            deleteBtn: document.getElementById('deleteBtn'),
            prevPageBtn: document.getElementById('prevPageBtn'),
            nextPageBtn: document.getElementById('nextPageBtn'),
            statusTip: document.getElementById('statusTip'),
            fullHalfToggle: document.getElementById('fullHalfToggle'),
            toggleText: document.getElementById('toggleText'),
            specialCharBtn: document.getElementById('specialCharBtn'),
            specialCharModal: document.getElementById('specialCharModal'),
            closeSpecialCharBtn: document.getElementById('closeSpecialCharBtn'),
            modalOverlay: document.getElementById('modalOverlay'),
            charCategoryTabs: document.getElementById('charCategoryTabs'),
            charDisplayArea: document.getElementById('charDisplayArea')
        };

        // 1. ç»Ÿä¸€åŠ è½½æ‰€æœ‰è¯å…¸æ–‡ä»¶
        async function loadAllDicts() {
            try {
                // å¹¶è¡ŒåŠ è½½ä¸‰ä¸ªè¯å…¸æ–‡ä»¶
                const [pinyinRes, half2fullRes, specialCharsRes] = await Promise.all([
                    fetch('./pinyin_dict.json'),
                    fetch('./half2full.json'),
                    fetch('./special_chars.json')
                ]);

                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!pinyinRes.ok) throw new Error('æ‹¼éŸ³è¯å…¸åŠ è½½å¤±è´¥');
                if (!half2fullRes.ok) throw new Error('å…¨è§’åŠè§’æ˜ å°„è¯å…¸åŠ è½½å¤±è´¥');
                if (!specialCharsRes.ok) throw new Error('ç‰¹æ®Šå­—ç¬¦è¯å…¸åŠ è½½å¤±è´¥');

                // è§£æJSON
                pinyinDict = await pinyinRes.json();
                half2full = await half2fullRes.json();
                specialChars = await specialCharsRes.json();
                currentCharCategory = Object.keys(specialChars)[0] || '';

                // ç”Ÿæˆå£°æ¯å­—å…¸å’Œå‰ç¼€å­—å…¸
                generateInitialsDict();
                generatePrefixDict();

                dom.statusTip.textContent = 'æ‰€æœ‰è¯å…¸åŠ è½½å®Œæˆï¼Œå¯å¼€å§‹è¾“å…¥';
                dom.statusTip.className = 'mt-4 text-center text-sm text-green-600';

                // åˆå§‹åŒ–ç‰¹æ®Šå­—ç¬¦é¢æ¿
                initSpecialCharPanel();
            } catch (error) {
                dom.statusTip.textContent = `åŠ è½½å¤±è´¥: ${error.message}ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨`;
                dom.statusTip.className = 'mt-4 text-center text-sm text-red-500';
                console.error('è¯å…¸åŠ è½½å¤±è´¥:', error);
            }
        }

        // ç”Ÿæˆå£°æ¯å­—å…¸
        function generateInitialsDict() {
            initialsDict = {};
            
            for (const [pinyin, words] of Object.entries(pinyinDict)) {
                const initials = extractInitials(pinyin);
                if (initials) {
                    if (!initialsDict[initials]) {
                        initialsDict[initials] = [];
                    }
                    // åˆå¹¶å€™é€‰è¯ï¼Œå»é‡
                    for (const word of words) {
                        if (!initialsDict[initials].includes(word)) {
                            initialsDict[initials].push(word);
                        }
                    }
                }
            }
        }

        // ç”Ÿæˆå‰ç¼€å­—å…¸
        function generatePrefixDict() {
            prefixDict = {};
            
            for (const [pinyin, words] of Object.entries(pinyinDict)) {
                const prefix = getPinyinPrefix(pinyin);
                if (prefix) {
                    if (!prefixDict[prefix]) {
                        prefixDict[prefix] = [];
                    }
                    // åˆå¹¶å€™é€‰è¯ï¼Œå»é‡
                    for (const word of words) {
                        if (!prefixDict[prefix].includes(word)) {
                            prefixDict[prefix].push(word);
                        }
                    }
                }
            }
        }

        // ä»æ‹¼éŸ³å­—ç¬¦ä¸²ä¸­æå–å£°æ¯
        function extractInitials(pinyin) {
            let result = '';
            let i = 0;
            
            while (i < pinyin.length) {
                let matched = false;
                
                // æ£€æŸ¥æœ€é•¿åŒ¹é…ï¼ˆä¼˜å…ˆåŒ¹é…2å­—ç¬¦çš„å£°æ¯ï¼‰
                for (let j = 2; j >= 1; j--) {
                    if (i + j <= pinyin.length) {
                        const sub = pinyin.substring(i, i + j);
                        if (INITIALS_MAP[sub]) {
                            result += sub;
                            i += j;
                            matched = true;
                            break;
                        }
                    }
                }
                
                // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å£°æ¯ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯éŸµæ¯å¼€å¤´ï¼ˆå¦‚a, e, oç­‰ï¼‰ï¼Œè·³è¿‡
                if (!matched) {
                    i++;
                }
            }
            
            return result;
        }

        // è·å–æ‹¼éŸ³å‰ç¼€ï¼ˆå°†æœ€åä¸€ä¸ªå­—æ›¿æ¢ä¸ºå£°æ¯ï¼‰
        function getPinyinPrefix(pinyin) {
            const initials = extractInitials(pinyin);
            if (initials.length < 2) {
                return null; // å¦‚æœå£°æ¯ä¸ªæ•°å°äº2ï¼Œä¸ç”Ÿæˆå‰ç¼€
            }
            
            // æ‰¾åˆ°æœ€åä¸€ä¸ªå£°æ¯çš„èµ·å§‹ä½ç½®
            let lastInitial = '';
            let lastInitialPos = 0;
            
            // ä»åå‘å‰æŸ¥æ‰¾æœ€åä¸€ä¸ªå£°æ¯
            for (let i = pinyin.length; i >= 0; i--) {
                for (let j = 2; j >= 1; j--) {
                    if (i - j >= 0) {
                        const sub = pinyin.substring(i - j, i);
                        if (INITIALS_MAP[sub]) {
                            // è¿™æ˜¯æœ€åä¸€ä¸ªå£°æ¯
                            lastInitial = sub;
                            lastInitialPos = i - j;
                            
                            // æ›¿æ¢æœ€åä¸€ä¸ªå­—ä¸ºå£°æ¯
                            return pinyin.substring(0, lastInitialPos) + lastInitial;
                        }
                    }
                }
            }
            
            return null;
        }

        // 2. ä¿®å¤å…¨è§’åŠè§’è½¬æ¢é€»è¾‘ï¼ˆæ ¸å¿ƒBUGä¿®å¤ï¼‰
        function convertToFullWidth(text) {
            // éå…¨è§’æ¨¡å¼ç›´æ¥è¿”å›åŸæ–‡æœ¬
            if (!isFullWidthMode || !text || typeof text !== 'string') return text;

            let result = '';
            for (let char of text) {
                // ä¼˜å…ˆä½¿ç”¨æ˜ å°„è¡¨ï¼Œæ— æ˜ å°„åˆ™ä¿ç•™åŸå­—ç¬¦
                result += half2full[char] || char;
            }
            return result;
        }

        // 3. è®¡ç®—æ€»é¡µæ•°å¹¶æ›´æ–°é¡µç ä¿¡æ¯
        function updatePageInfo() {
            totalPages = Math.ceil(candidateWords.length / pageSize);
            const currentPageNum = currentPage + 1;
            dom.pageInfo.textContent = `ç¬¬${currentPageNum}é¡µ/å…±${totalPages || 1}é¡µ`;

            // ç¦ç”¨/å¯ç”¨ç¿»é¡µæŒ‰é’®
            dom.prevPageBtn.disabled = currentPage <= 0;
            dom.nextPageBtn.disabled = currentPage >= totalPages - 1;
            dom.prevPageBtn.style.opacity = currentPage <= 0 ? '0.5' : '1';
            dom.nextPageBtn.style.opacity = currentPage >= totalPages - 1 ? '0.5' : '1';
        }

        // è´ªå¿ƒç®—æ³•åŒ¹é…è¾“å…¥ä¸­æœ€é•¿çš„å¯åŒ¹é…å¤´éƒ¨
        function greedyMatchPinyin(input) {
            let bestMatch = null;
            let bestLength = 0;
            
            // æŸ¥æ‰¾æœ€é•¿çš„åŒ¹é…
            for (const [pinyin, words] of Object.entries(pinyinDict)) {
                if (input.startsWith(pinyin) && pinyin.length > bestLength) {
                    bestMatch = { pinyin, words };
                    bestLength = pinyin.length;
                }
            }
            
            return bestMatch;
        }

        // 4. åŒ¹é…æ‹¼éŸ³å¹¶æ¸²æŸ“å€™é€‰è¯ï¼ˆæ”¯æŒç¿»é¡µï¼‰- æ–°å¢åŒ¹é…é€»è¾‘
        function renderCandidates(pinyin) {
            candidateWords = [];
            dom.candidateList.innerHTML = '';
            currentPage = 0; // é‡ç½®é¡µç 
            greedyMatched = false; // é‡ç½®è´ªå¿ƒåŒ¹é…æ ‡å¿—

            // æ‹¼éŸ³ä¸ºç©ºæ—¶éšè—å€™é€‰åŒº
            if (!pinyin.trim()) {
                dom.candidateArea.classList.add('hidden');
                return;
            }

            const pinyinLower = pinyin.toLowerCase();
            let matchedWords = [];
            let greedyMatchResult = null;
            
            // æ­¥éª¤iï¼šå…ˆåŒ¹é…åŸæ‹¼éŸ³å­—å…¸
            if (pinyinDict[pinyinLower]) {
                matchedWords = pinyinDict[pinyinLower];
            }
            // æ­¥éª¤iiï¼šå¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œåˆ™åŒ¹é…å‰ç¼€å­—å…¸
            else if (!matchedWords.length && prefixDict[pinyinLower]) {
                matchedWords = prefixDict[pinyinLower];
            }
            // æ­¥éª¤iiiï¼šå¦‚æœå‰ç¼€å­—å…¸æ²¡æœ‰åŒ¹é…ï¼Œåˆ™åŒ¹é…å£°æ¯å­—å…¸
            else if (!matchedWords.length && initialsDict[pinyinLower]) {
                matchedWords = initialsDict[pinyinLower];
            }
            // æ­¥éª¤ivï¼šå¦‚æœéƒ½æ²¡æœ‰åŒ¹é…ï¼Œä½¿ç”¨è´ªå¿ƒç®—æ³•
            else if (!matchedWords.length) {
                greedyMatchResult = greedyMatchPinyin(pinyinLower);
                if (greedyMatchResult) {
                    matchedWords = greedyMatchResult.words;
                    greedyMatched = true;
                }
            }

            candidateWords = matchedWords;

            if (matchedWords.length === 0) {
                dom.candidateList.innerHTML = '<span class="text-gray-500">æ— åŒ¹é…å­—è¯</span>';
                dom.candidateArea.classList.remove('hidden');
                updatePageInfo();
                return;
            }

            // æ¸²æŸ“å½“å‰é¡µçš„å€™é€‰è¯
            renderCurrentPageCandidates();
            dom.candidateArea.classList.remove('hidden');
            updatePageInfo();
        }

        // 5. æ¸²æŸ“å½“å‰é¡µçš„å€™é€‰è¯
        function renderCurrentPageCandidates() {
            dom.candidateList.innerHTML = '';
            const start = currentPage * pageSize;
            const end = start + pageSize;
            const currentPageWords = candidateWords.slice(start, end);

            if (currentPageWords.length === 0) {
                dom.candidateList.innerHTML = '<span class="text-gray-500">å½“å‰é¡µæ— å€™é€‰è¯</span>';
                return;
            }

            // ç”Ÿæˆå€™é€‰è¯é¡¹
            currentPageWords.forEach((word, index) => {
                const num = index + 1;
                const candidateItem = document.createElement('span');
                candidateItem.className = 'candidate-item';
                candidateItem.innerHTML = `<span class="font-bold text-button mr-1">${num}</span>${word}`;
                candidateItem.dataset.index = start + index; // çœŸå®ç´¢å¼•
                candidateItem.addEventListener('click', () => selectCandidate(start + index));
                dom.candidateList.appendChild(candidateItem);
            });
        }

        // 6. ç¿»é¡µåŠŸèƒ½
        function changePage(offset) {
            const newPage = currentPage + offset;
            if (newPage >= 0 && newPage < totalPages) {
                currentPage = newPage;
                renderCurrentPageCandidates();
                updatePageInfo();
                dom.pinyinInput.focus();
            }
        }

        // 7. é€‰æ‹©å€™é€‰è¯ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šæ¸…ç©ºå€™é€‰è¯æ•°ç»„ï¼Œæ–°å¢è´ªå¿ƒåŒ¹é…å¤„ç†ï¼‰
        function selectCandidate(index) {
            if (index >= 0 && index < candidateWords.length) {
                const selectedWord = candidateWords[index];
                
                // å¦‚æœæ˜¯è´ªå¿ƒåŒ¹é…æ¨¡å¼
                if (greedyMatched) {
                    // è·å–å½“å‰è¾“å…¥
                    const currentInput = dom.pinyinInput.value.toLowerCase();
                    
                    // è´ªå¿ƒåŒ¹é…æœ€é•¿çš„æ‹¼éŸ³
                    const greedyResult = greedyMatchPinyin(currentInput);
                    if (greedyResult) {
                        // å°†å€™é€‰è¯è¾“å…¥åˆ°ç»“æœæ¡†
                        dom.outputArea.value += selectedWord;
                        
                        // ä»è¾“å…¥ä¸­å»æ‰åŒ¹é…æˆåŠŸçš„å¤´éƒ¨å­—ç¬¦ä¸²
                        const remainingInput = currentInput.substring(greedyResult.pinyin.length);
                        dom.pinyinInput.value = remainingInput;
                        
                        // å¯¹å‰©ä½™éƒ¨åˆ†é‡æ–°è¿›è¡Œå¤„ç†
                        if (remainingInput.length > 0) {
                            renderCandidates(remainingInput);
                        } else {
                            // æ¸…ç©ºå€™é€‰è¯æ•°ç»„
                            candidateWords = [];
                            currentPage = 0;
                            updatePageInfo();
                            dom.candidateList.innerHTML = '';
                            dom.candidateArea.classList.add('hidden');
                        }
                    }
                } else {
                    // æ­£å¸¸é€‰æ‹©å€™é€‰è¯
                    dom.outputArea.value += selectedWord;
                    dom.pinyinInput.value = '';
                    // å…³é”®ä¿®å¤1ï¼šæ¸…ç©ºå€™é€‰è¯æ•°ç»„
                    candidateWords = [];
                    // å…³é”®ä¿®å¤2ï¼šé‡ç½®é¡µç 
                    currentPage = 0;
                    // å…³é”®ä¿®å¤3ï¼šæ›´æ–°é¡µç ä¿¡æ¯
                    updatePageInfo();
                    // æ¸…ç©ºå€™é€‰è¯åˆ—è¡¨DOM
                    dom.candidateList.innerHTML = '';
                    dom.candidateArea.classList.add('hidden');
                }
                dom.pinyinInput.focus();
            }
        }

        // 8. å¤åˆ¶åŠŸèƒ½ï¼ˆç§»é™¤trimï¼Œä¿ç•™æ‰€æœ‰ç©ºæ ¼ï¼‰
        function copyToClipboard() {
            const text = dom.outputArea.value; // ç§»é™¤trim()ï¼ŒåŸæ ·å¤åˆ¶
            if (!text) {
                showTip('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'red');
                return;
            }
            navigator.clipboard.writeText(text)
                .then(() => showTip('å¤åˆ¶æˆåŠŸï¼', 'green'))
                .catch(() => {
                    // é™çº§æ–¹æ¡ˆ
                    dom.outputArea.focus();
                    dom.outputArea.select();
                    document.execCommand('copy');
                    showTip('å¤åˆ¶æˆåŠŸï¼', 'green');
                });
        }

        // 9. æœç´¢åŠŸèƒ½ï¼ˆç™¾åº¦æœç´¢ï¼‰
        function searchInBaidu() {
            const text = dom.outputArea.value.trim();
            if (!text) {
                showTip('æ²¡æœ‰å¯æœç´¢çš„å†…å®¹', 'red');
                return;
            }
            const searchUrl = `https://www.baidu.com/s?wd=${encodeURIComponent(text)}`;
            window.open(searchUrl, '_blank');
        }

        // 10. æ¸…ç©ºåŠŸèƒ½
        function clearAll() {
            dom.outputArea.value = '';
            dom.pinyinInput.value = '';
            // æ¸…ç©ºå€™é€‰è¯æ•°ç»„
            candidateWords = [];
            currentPage = 0;
            updatePageInfo();
            dom.candidateList.innerHTML = '';
            dom.candidateArea.classList.add('hidden');
            showTip('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹', 'gray');
            dom.pinyinInput.focus();
        }

        // 11. åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦
        function deleteLastChar() {
            const currentValue = dom.outputArea.value;
            dom.outputArea.value = currentValue.substring(0, currentValue.length - 1);
            dom.pinyinInput.focus();
        }

        // 12. æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showTip(message, color) {
            dom.statusTip.textContent = message;
            const colorClass = {
                green: 'text-green-600',
                red: 'text-red-500',
                gray: 'text-gray-500'
            }[color] || 'text-gray-500';
            dom.statusTip.className = `mt-4 text-center text-sm ${colorClass}`;

            // 3ç§’åæ¢å¤é»˜è®¤æç¤º
            setTimeout(() => {
                dom.statusTip.textContent = Object.keys(pinyinDict).length ? 'å¯æ­£å¸¸è¾“å…¥' : 'è¯å…¸åŠ è½½ä¸­...';
                dom.statusTip.className = 'mt-4 text-center text-sm text-gray-500';
            }, 3000);
        }

        // 13. ä¿®å¤å…¨è§’/åŠè§’åˆ‡æ¢é€»è¾‘ï¼ˆä¿®å¤BUGï¼‰
        function toggleFullHalfMode() {
            isFullWidthMode = !isFullWidthMode;

            // ä¿®å¤ï¼šç¡®ä¿æŒ‰é’®çŠ¶æ€å’ŒåŠŸèƒ½å®Œå…¨åŒæ­¥
            if (isFullWidthMode) {
                dom.toggleText.textContent = 'å…¨è§’';
                dom.fullHalfToggle.classList.remove('bg-toggleOff');
                dom.fullHalfToggle.classList.add('bg-toggleOn');
                showTip('å·²åˆ‡æ¢ä¸ºå…¨è§’æ¨¡å¼ï¼ˆç¬¦å·è‡ªåŠ¨è½¬æ¢ä¸ºå…¨è§’ï¼‰', 'green');
            } else {
                dom.toggleText.textContent = 'åŠè§’';
                dom.fullHalfToggle.classList.remove('bg-toggleOn');
                dom.fullHalfToggle.classList.add('bg-toggleOff');
                showTip('å·²åˆ‡æ¢ä¸ºåŠè§’æ¨¡å¼ï¼ˆç¬¦å·ä¿æŒåŸæ ·ï¼‰', 'green');
            }

            // é‡æ–°æ¸²æŸ“å½“å‰æ‹¼éŸ³è¾“å…¥ï¼Œé¢„è§ˆå…¨è§’/åŠè§’æ•ˆæœ
            if (dom.pinyinInput.value) {
                renderCandidates(dom.pinyinInput.value);
            }

            // èšç„¦è¾“å…¥æ¡†ï¼Œä¿æŒæ“ä½œè¿è´¯æ€§
            dom.pinyinInput.focus();
        }

        // 14. åˆå§‹åŒ–ç‰¹æ®Šå­—ç¬¦é¢æ¿
        function initSpecialCharPanel() {
            if (!specialChars || Object.keys(specialChars).length === 0) return;

            // æ¸…ç©ºåŸæœ‰æ ‡ç­¾
            dom.charCategoryTabs.innerHTML = '';

            // ç”Ÿæˆåˆ†ç±»æ ‡ç­¾
            Object.keys(specialChars).forEach((category) => {
                const tab = document.createElement('div');
                // åˆå§‹é€‰ä¸­ç¬¬ä¸€ä¸ªåˆ†ç±»
                const isActive = category === currentCharCategory;
                tab.className = `char-category-tab ${isActive ? 'bg-button text-white' : 'bg-gray-200 hover:bg-gray-300'}`;
                tab.textContent = category;
                tab.dataset.category = category;

                // ç»‘å®šåˆ†ç±»åˆ‡æ¢äº‹ä»¶
                tab.addEventListener('click', () => {
                    // æ›´æ–°æ‰€æœ‰æ ‡ç­¾æ ·å¼
                    document.querySelectorAll('.char-category-tab').forEach(t => {
                        t.classList.remove('bg-button', 'text-white');
                        t.classList.add('bg-gray-200', 'hover:bg-gray-300');
                    });
                    // é«˜äº®å½“å‰æ ‡ç­¾
                    tab.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                    tab.classList.add('bg-button', 'text-white');
                    // æ›´æ–°å½“å‰åˆ†ç±»å¹¶æ¸²æŸ“å­—ç¬¦
                    currentCharCategory = category;
                    renderSpecialChars(category);
                });

                dom.charCategoryTabs.appendChild(tab);
            });

            // åˆå§‹æ¸²æŸ“ç¬¬ä¸€ä¸ªåˆ†ç±»çš„å­—ç¬¦
            renderSpecialChars(currentCharCategory);
        }

        // 15. æ¸²æŸ“æŒ‡å®šåˆ†ç±»çš„ç‰¹æ®Šå­—ç¬¦
        function renderSpecialChars(category) {
            dom.charDisplayArea.innerHTML = '';
            const chars = specialChars[category] || [];

            if (chars.length === 0) {
                dom.charDisplayArea.innerHTML = '<div class="col-span-8 text-center text-gray-500 py-4">è¯¥åˆ†ç±»æš‚æ— å­—ç¬¦</div>';
                return;
            }

            chars.forEach((char) => {
                const charItem = document.createElement('div');
                charItem.className = 'char-item';
                charItem.textContent = char;
                charItem.title = `æ’å…¥ã€Œ${char}ã€`;
                // ç»‘å®šæ’å…¥äº‹ä»¶
                charItem.addEventListener('click', () => {
                    dom.outputArea.value += char;
                    dom.outputArea.focus();
                });
                dom.charDisplayArea.appendChild(charItem);
            });
        }

        // 16. æ‰“å¼€ç‰¹æ®Šå­—ç¬¦é¢æ¿ï¼ˆä¿®å¤å¼¹çª—é€»è¾‘ï¼‰
        function openSpecialCharPanel() {
            // ç¡®ä¿é¢æ¿å·²åˆå§‹åŒ–
            if (!specialChars || Object.keys(specialChars).length === 0) {
                showTip('ç‰¹æ®Šå­—ç¬¦è¯å…¸åŠ è½½å¤±è´¥ï¼Œæ— æ³•æ‰“å¼€é¢æ¿', 'red');
                return;
            }

            // ä¿®å¤ï¼šç¡®ä¿æ¨¡æ€æ¡†å®Œå…¨æ˜¾ç¤º
            dom.specialCharModal.classList.remove('hidden');
            dom.modalOverlay.classList.remove('hidden');

            // é‡æ–°æ¸²æŸ“å½“å‰åˆ†ç±»ï¼ˆç¡®ä¿æœ€æ–°ï¼‰
            renderSpecialChars(currentCharCategory);

            // èšç„¦åˆ°æ¨¡æ€æ¡†ä»¥ä¾¿é”®ç›˜æ“ä½œ
            dom.specialCharModal.focus();
        }

        // 17. å…³é—­ç‰¹æ®Šå­—ç¬¦é¢æ¿
        function closeSpecialCharPanel() {
            dom.specialCharModal.classList.add('hidden');
            dom.modalOverlay.classList.add('hidden');
            dom.pinyinInput.focus();
        }

        // 18. ç»‘å®šæ‰€æœ‰äº‹ä»¶ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šç©ºæ ¼é”®åˆ¤æ–­é€»è¾‘ï¼‰
        function bindEvents() {
            // æ‹¼éŸ³è¾“å…¥æ¡†è¾“å…¥äº‹ä»¶
            dom.pinyinInput.addEventListener('input', (e) => {
                renderCandidates(e.target.value);
            });

            // å…¨å±€é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', (e) => {
                // ESCé”®å…³é—­ç‰¹æ®Šå­—ç¬¦é¢æ¿
                if (e.key === 'Escape' && !dom.specialCharModal.classList.contains('hidden')) {
                    closeSpecialCharPanel();
                    e.preventDefault();
                    return;
                }

                // æ•°å­—é”®1-9é€‰æ‹©å€™é€‰è¯ï¼ˆå¢åŠ è¾“å…¥æ¡†éç©ºåˆ¤æ–­ï¼‰
                if (e.key >= 1 && e.key <= 9) {
                    // å…³é”®ä¿®å¤ï¼šè¾“å…¥æ¡†ä¸ºç©ºæ—¶ä¸è§¦å‘æ•°å­—é€‰æ‹©
                    if (dom.pinyinInput.value === '') return;
                    const start = currentPage * pageSize;
                    const index = start + (parseInt(e.key) - 1);
                    if (candidateWords.length > 0 && index < candidateWords.length) {
                        e.preventDefault();
                        selectCandidate(index);
                    }
                }
                // ç©ºæ ¼é”®é€‰æ‹©ç¬¬ä¸€ä¸ªå€™é€‰è¯ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šå¢åŠ è¾“å…¥æ¡†éç©ºåˆ¤æ–­ï¼‰
                else if (e.key === ' ') {
                    // åªæœ‰è¾“å…¥æ¡†æœ‰å†…å®¹ä¸”æœ‰å€™é€‰è¯æ—¶ï¼Œæ‰è§¦å‘å€™é€‰è¯é€‰æ‹©
                    if (candidateWords.length > 0 && dom.pinyinInput.value !== '') {
                        e.preventDefault();
                        // é€‰æ‹©ç¬¬ä¸€ä¸ªå€™é€‰è¯
                        selectCandidate(currentPage * pageSize);
                    }
                    // å¦åˆ™ä¿ç•™é»˜è®¤è¡Œä¸ºï¼ˆè¾“å…¥ç©ºæ ¼ï¼‰
                }
                // å›è½¦é”®ï¼šè¾“å…¥æ‹¼éŸ³æ¡†å†…å®¹ï¼ˆä¿ç•™æ‰€æœ‰ç©ºæ ¼ï¼Œçº¯ç©ºæ ¼ä¹Ÿå¯æäº¤ï¼‰
                else if (e.key === 'Enter') {
                    e.preventDefault();
                    const inputText = dom.pinyinInput.value; // ç§»é™¤trim()ï¼Œä¿ç•™æ‰€æœ‰ç©ºæ ¼
                    if (inputText !== '') { // æ”¹ä¸ºä¸¥æ ¼åˆ¤ç©ºï¼Œçº¯ç©ºæ ¼ä¹Ÿæ‰§è¡Œ
                        const convertedText = convertToFullWidth(inputText);
                        dom.outputArea.value += convertedText;
                        // æ¸…ç©ºå€™é€‰è¯æ•°ç»„
                        candidateWords = [];
                        currentPage = 0;
                        updatePageInfo();
                        dom.candidateList.innerHTML = '';
                        dom.pinyinInput.value = '';
                        dom.candidateArea.classList.add('hidden');
                    }
                    dom.pinyinInput.focus();
                }
                // ç¿»é¡µé”®ï¼ˆå¢åŠ è¾“å…¥æ¡†éç©ºåˆ¤æ–­ï¼‰
                else if (e.key === 'PageUp' || e.key === '[' || e.key === '-') {
                    if (dom.pinyinInput.value !== '' && candidateWords.length > pageSize) {
                        e.preventDefault();
                        changePage(-1);
                    }
                } else if (e.key === 'PageDown' || e.key === ']' || e.key === '=') {
                    if (dom.pinyinInput.value !== '' && candidateWords.length > pageSize) {
                        e.preventDefault();
                        changePage(1);
                    }
                }
                // é€€æ ¼é”®
                else if (e.key === 'Backspace' && dom.pinyinInput.value === '') {
                    deleteLastChar();
                }
            });

            // ç¿»é¡µæŒ‰é’®
            dom.prevPageBtn.addEventListener('click', () => changePage(-1));
            dom.nextPageBtn.addEventListener('click', () => changePage(1));

            // åŠŸèƒ½æŒ‰é’®
            dom.copyBtn.addEventListener('click', copyToClipboard);
            dom.searchBtn.addEventListener('click', searchInBaidu);
            dom.clearBtn.addEventListener('click', clearAll);
            dom.deleteBtn.addEventListener('click', deleteLastChar);

            // å…¨è§’/åŠè§’åˆ‡æ¢
            dom.fullHalfToggle.addEventListener('click', toggleFullHalfMode);

            // ç‰¹æ®Šå­—ç¬¦é¢æ¿äº‹ä»¶
            dom.specialCharBtn.addEventListener('click', openSpecialCharPanel);
            dom.closeSpecialCharBtn.addEventListener('click', closeSpecialCharPanel);
            dom.modalOverlay.addEventListener('click', closeSpecialCharPanel);

            // é¡µé¢åŠ è½½å®Œæˆåèšç„¦è¾“å…¥æ¡†
            window.addEventListener('load', () => {
                dom.pinyinInput.focus();
            });
        }

        // åˆå§‹åŒ–ç¨‹åº
        function init() {
            bindEvents();   // ç»‘å®šæ‰€æœ‰äº‹ä»¶
            loadAllDicts(); // åŠ è½½æ‰€æœ‰è¯å…¸
        }

        // å¯åŠ¨ç¨‹åº
        init();
    </script>
</body>
</html>
