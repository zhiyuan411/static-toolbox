<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP地址 | 域名 | MAC地址工具集</title>
    <script>
        // 提前发起本站数据请求
        (function() {
            // 创建全局Promise用于跟踪请求状态
            window.cnfaqV4Promise = fetch('https://ipv4.cnfaq.cn')
                .then(response => response.text())
                .catch(err => {
                    console.error('cnfaqV4请求失败', err);
                    return null;
                });

            window.cnfaqV6Promise = fetch('https://ipv6.cnfaq.cn')
                .then(response => response.text())
                .catch(err => {
                    console.error('cnfaqV6请求失败', err);
                    return null;
                });
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        neutral: '#64748B',
                        danger: '#EF4444',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .card-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            }
            .btn-hover {
                @apply transition-all duration-200 hover:opacity-80;
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .notification {
                animation: slideIn 0.3s ease-out, slideOut 0.3s ease-in 2.7s forwards;
            }
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            .progress-bar {
                height: 4px;
                background: linear-gradient(90deg, #3B82F6 0%, #10B981 100%);
                background-size: 200% 100%;
                animation: progress-animation 2s linear infinite;
            }
            @keyframes progress-animation {
                0% { background-position: 100% 0; }
                100% { background-position: -100% 0; }
            }
            .pulse {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }
            .section-divider {
                border-top: 1px dashed #e5e7eb;
                margin: 0.75rem 0;
            }
            .query-section {
                @apply transition-all duration-200;
            }
            .query-section:hover:not(.unsupported) {
                @apply bg-blue-50;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <!-- 通知提示框 - 右上方弹出 -->
    <div id="notification" class="fixed top-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 hidden notification flex items-center max-w-xs">
        <i id="notificationIcon" class="fa mr-2"></i>
        <span id="notificationText"></span>
    </div>


    <div class="container mx-auto px-4 py-12 max-w-6xl">
        <header class="text-center mb-12">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-4">
                <i class="fa fa-globe text-primary mr-3"></i>IP地址 | 域名 | MAC地址工具集
            </h1>
        </header>


        <!-- 主要IP地址展示区域 -->
        <div class="mb-8 space-y-6">
            <div class="bg-white rounded-xl p-6 card-shadow fade-in">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fa fa-server text-primary mr-2"></i>
                    您的IP地址
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- IPv4地址 -->
                    <div class="border border-gray-100 rounded-lg p-5 bg-gray-50">
                        <div class="flex items-center mb-3">
                            <span class="text-sm font-medium text-gray-500">IPv4 地址</span>
                            <button id="refreshV4" onclick="refreshIPv4()" class="ml-2 text-neutral btn-hover text-sm" title="刷新">
                                <i class="fa fa-refresh"></i>
                            </button>
                        </div>
                        <div class="flex items-center">
                            <span id="cnfaqV4Ip" class="font-mono break-all text-lg text-gray-800 flex-1">加载中...</span>
                            <button id="copyCnfaqV4Ip"
                                    onclick="copyToClipboard(document.getElementById('cnfaqV4Ip').textContent)"
                                    class="ml-2 text-neutral btn-hover hidden" title="复制">
                                <i class="fa fa-copy"></i>
                            </button>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">来源: 本站-IPv4</div>
                    </div>


                    <!-- IPv6地址 -->
                    <div class="border border-gray-100 rounded-lg p-5 bg-gray-50">
                        <div class="flex items-center mb-3">
                            <span class="text-sm font-medium text-gray-500">IPv6 地址</span>
                            <button id="refreshV6" onclick="refreshIPv6()" class="ml-2 text-neutral btn-hover text-sm" title="刷新">
                                <i class="fa fa-refresh"></i>
                            </button>
                        </div>
                        <div class="flex items-center">
                            <span id="cnfaqV6Ipv6" class="font-mono break-all text-lg text-gray-800 flex-1">加载中...</span>
                            <button id="copyCnfaqV6Ipv6"
                                    onclick="copyToClipboard(document.getElementById('cnfaqV6Ipv6').textContent)"
                                    class="ml-2 text-neutral btn-hover hidden" title="复制">
                                <i class="fa fa-copy"></i>
                            </button>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">来源: 本站-IPv6</div>
                    </div>
                </div>

                <!-- 显示所有数据源的按钮 -->
                <div class="text-center border-t border-gray-100 pt-4">
                    <button id="toggleAllSources" onclick="toggleAllSourcesHandler()" class="bg-primary text-white px-6 py-2 rounded-lg btn-hover inline-flex items-center">
                        <i class="fa fa-list-alt mr-2"></i>
                        <span>显示所有数据源</span>
                    </button>
                </div>

                <!-- 数据源展示容器，默认隐藏 -->
                <div id="sourcesContainer" class="space-y-6 hidden">
                    <!-- 数据源内容将在这里动态生成 -->
                    <div class="text-center py-12 text-neutral">
                        <div class="relative">
                            <div class="progress-bar w-full rounded-full"></div>
                            <div class="mt-6">
                                <i class="fa fa-circle-o-notch fa-spin text-neutral text-2xl mb-4"></i>
                                <p class="text-neutral">正在加载所有数据源，请稍候...</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>


        <!-- Ping检测功能区域 -->
        <div class="mb-8 space-y-6">
            <div class="bg-white rounded-xl p-6 card-shadow fade-in">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fa fa-globe text-primary mr-2"></i>
                    Ping检测功能
                </h2>

                <!-- 添加浏览器拦截提示 -->
                <div class="mb-4 bg-amber-50 border-l-4 border-amber-500 rounded p-4 flex items-start">
                    <div class="flex-1">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:gap-3"> <!-- 增大水平间距 -->
                            <i class="fa fa-exclamation-triangle text-amber-600 text-lg mr-3 self-start"></i>
                            <!-- 首行文字与图标精确对齐 -->
                            <p class="text-sm font-medium text-amber-700 leading-normal">
                                点击 <span class="font-bold">Ping检测</span> 按钮将连续打开多个检测页面
                            </p>
                            <!-- 增加间隔符和间距优化 -->
                            <div class="mt-1 sm:mt-0 flex items-center">
                                <span class="text-xs sm:text-sm text-amber-600 mr-2 hidden sm:inline-block">|</span>
                                <span class="text-xs sm:text-sm text-amber-600">
                                    默认会被浏览器拦截，
                                    <span class="inline-block bg-amber-100 px-2 py-1 rounded ml-1 text-amber-700 border border-amber-200">
                                        请在右上角 <i class="fa fa-caret-up"></i> 点击「允许弹窗」
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 输入区域 -->
                <div class="mb-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <input
                            type="text"
                            id="pingTarget"
                            placeholder="请输入IP地址或域名"
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        >
                        <button
                            id="startPingBtn"
                            onclick="startPingCheck()"
                            class="bg-primary text-white px-6 py-3 rounded-lg btn-hover inline-flex items-center justify-center whitespace-nowrap"
                        >
                            <i class="fa fa-play mr-2"></i>
                            Ping检测
                        </button>
                    </div>
                </div>

                <!-- 第三方网站选项区域 - 默认隐藏 -->
                <div id="pingSitesContainer" class="border-t border-gray-100 pt-4">
                    <div class="flex flex-wrap items-center justify-between mb-4">
                        <button
                            id="togglePingSitesBtn"
                            onclick="togglePingSites()"
                            class="text-primary text-sm font-medium flex items-center btn-hover"
                        >
                            <span id="pingSitesBtnText">选择检测网站（默认全部）</span>
                            <i id="pingSitesBtnIcon" class="fa fa-chevron-down ml-1 text-xs"></i>
                        </button>

                        <!-- 新增的四个控制按钮，优化了顺序 -->
                        <div class="flex gap-2 mt-2 sm:mt-0">
                            <button
                                id="selectAllBtn"
                                onclick="selectAllSites()"
                                class="bg-secondary text-white px-3 py-1 rounded text-sm btn-hover flex items-center"
                            >
                                <i class="fa fa-check mr-1"></i>
                                全选
                            </button>
                            <button
                                id="clearAllChecksBtn"
                                onclick="clearAllChecks()"
                                class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm btn-hover flex items-center"
                            >
                                <i class="fa fa-times mr-1"></i>
                                取消勾选
                            </button>
                            <button
                                id="selectOnlyIPv4Btn"
                                onclick="selectOnlyIPv4()"
                                class="bg-blue-100 text-blue-700 px-3 py-1 rounded text-sm btn-hover flex items-center"
                            >
                                <i class="fa fa-globe mr-1"></i>
                                仅IPv4
                            </button>
                            <button
                                id="selectOnlyIPv6Btn"
                                onclick="selectOnlyIPv6()"
                                class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded text-sm btn-hover flex items-center"
                            >
                                <i class="fa fa-globe mr-1"></i>
                                仅IPv6
                            </button>
                        </div>
                    </div>

                    <div id="pingSitesList" class="grid grid-cols-2 sm:grid-cols-4 gap-3 hidden">
                        <!-- 网站选项将通过JavaScript动态生成 -->
                        <div id="pingSitesLoading" class="col-span-full text-center py-8 text-neutral">
                            <i class="fa fa-circle-o-notch fa-spin text-neutral text-xl mb-2"></i>
                            <p class="text-sm">正在加载检测网站列表...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- IP/域名信息查询区域 -->
        <div class="mb-8 space-y-6">
            <div class="bg-white rounded-xl p-6 card-shadow fade-in">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fa fa-search text-primary mr-2"></i>
                    IP/域名信息查询
                </h2>

                <!-- 输入区域 -->
                <div class="mb-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <input
                            type="text"
                            id="ipDomainQuery"
                            placeholder="请输入IP地址或域名"
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        >
                        <button
                            id="startQueryBtn"
                            onclick="startIpDomainQuery()"
                            class="bg-primary text-white px-6 py-3 rounded-lg btn-hover inline-flex items-center justify-center whitespace-nowrap"
                        >
                            <i class="fa fa-search mr-2"></i>
                            查询
                        </button>
                    </div>
                </div>

                <!-- 结果展示区域 -->
                <div id="queryResultsContainer" class="border-t border-gray-100 pt-4 hidden">
                    <!-- 结果折叠/展开控制 -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-gray-700">
                            查询结果 <span id="queryTargetDisplay" class="text-primary font-normal"></span>
                        </h3>
                        <button
                            id="toggleResultsBtn"
                            onclick="toggleQueryResults()"
                            class="text-primary text-sm font-medium flex items-center btn-hover"
                        >
                            <span id="toggleResultsText">收起结果</span>
                            <i id="toggleResultsIcon" class="fa fa-chevron-up ml-1 text-xs"></i>
                        </button>
                    </div>

                    <!-- 结果内容区域 -->
                    <div id="queryResultsContent">
                        <!-- 加载状态 -->
                        <div id="queryLoading" class="text-center py-12 text-neutral">
                            <i class="fa fa-circle-o-notch fa-spin text-neutral text-2xl mb-4"></i>
                            <p class="text-neutral">正在查询信息，请稍候...</p>
                        </div>

                        <!-- 结果将通过JavaScript动态生成 -->
                        <div id="queryResultsList" class="space-y-6 hidden">
                            <!-- 表头 -->
                            <div class="grid grid-cols-10 gap-2 p-3 bg-gray-100 rounded-lg font-medium text-sm">
                                <div class="col-span-12 md:col-span-2">API名称</div>
                                <div class="col-span-12 md:col-span-2">综合信息</div>
                                <div class="col-span-12 md:col-span-2">Whois查询</div>
                                <div class="col-span-12 md:col-span-2">DNS解析</div>
                                <div class="col-span-12 md:col-span-2">其他信息</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- MAC地址查询区域 -->
        <div class="mb-8 space-y-6">
            <div class="bg-white rounded-xl p-6 card-shadow fade-in">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fa fa-wifi text-primary mr-2"></i>
                    MAC地址查询
                </h2>

                <!-- 输入区域 -->
                <div class="mb-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <input
                            type="text"
                            id="macAddressQuery"
                            placeholder="请输入MAC地址 (例如: AA:BB:CC:DD:EE:FF 或 AA-BB-CC-DD-EE-FF 等)"
                            class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                        >
                        <button
                            id="startMacQueryBtn"
                            onclick="startIeeeMacQuery()"
                            class="bg-primary text-white px-6 py-3 rounded-lg btn-hover inline-flex items-center justify-center whitespace-nowrap"
                        >
                            <i class="fa fa-search mr-2"></i>
                            查询
                        </button>
                    </div>
                </div>

                <!-- 结果展示区域 -->
                <div id="macQueryResultsContainer" class="border-t border-gray-100 pt-4 hidden">
                    <!-- 结果标题 -->
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-gray-700">
                            MAC查询结果 <span id="macQueryTargetDisplay" class="text-primary font-normal"></span>
                        </h3>
                    </div>

                    <!-- 本站数据源结果区域 -->
                    <div id="ieeeMacResult" class="bg-gray-50 p-5 rounded-lg border border-gray-200 mb-6">
                        <div class="flex items-center mb-3">
                            <i class="fa fa-database text-primary mr-2"></i>
                            <span class="font-medium text-gray-800">本站（IEEE官方数据）</span>
                        </div>
                        
                        <!-- 加载状态 -->
                        <div id="ieeeLoading" class="text-center py-12 text-neutral hidden">
                            <i class="fa fa-circle-o-notch fa-spin text-neutral text-2xl mb-4"></i>
                            <p class="text-neutral">正在查询本站数据，请稍候...</p>
                        </div>
                        
                        <!-- 结果内容 -->
                        <div id="ieeeResultContent" class="hidden space-y-4">
                            <div>
                                <span class="text-sm font-medium text-gray-500">组织名：</span>
                                <span id="ieeeOrganization" class="text-gray-800 font-mono"></span>
                            </div>
                            <div>
                                <span class="text-sm font-medium text-gray-500">地址：</span>
                                <span id="ieeeAddress" class="text-gray-800 font-mono break-all"></span>
                            </div>
                            
                            <!-- 查询所有数据源按钮 -->
                            <div class="pt-3 border-t border-gray-200">
                                <button
                                    id="queryAllMacSourcesBtn"
                                    onclick="startAllMacSourcesQuery()"
                                    class="bg-secondary text-white px-4 py-2 rounded-lg btn-hover inline-flex items-center text-sm"
                                >
                                    <i class="fa fa-plus-circle mr-1"></i>
                                    更多数据源
                                </button>
                            </div>
                        </div>
                        
                        <!-- 错误状态 -->
                        <div id="ieeeError" class="text-center py-12 text-neutral hidden">
                            <i class="fa fa-exclamation-circle text-danger text-2xl mb-4"></i>
                            <p id="ieeeErrorMessage" class="text-danger"></p>
                            <button
                                id="queryAllMacSourcesBtn"
                                onclick="startAllMacSourcesQuery()"
                                class="bg-secondary text-white px-4 py-2 rounded-lg btn-hover inline-flex items-center text-sm"
                            >
                                <i class="fa fa-plus-circle mr-1"></i>
                                更多数据源
                            </button>
                        </div>
                    </div>
                    
                    <!-- 其他数据源结果区域 -->
                    <div id="otherMacSourcesResults" class="hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-md font-medium text-gray-700">其他数据源结果</h4>
                            <button
                                id="toggleOtherMacResultsBtn"
                                onclick="toggleOtherMacQueryResults()"
                                class="text-primary text-sm font-medium flex items-center btn-hover"
                            >
                                <span id="toggleOtherMacResultsText">收起结果</span>
                                <i id="toggleOtherMacResultsIcon" class="fa fa-chevron-up ml-1 text-xs"></i>
                            </button>
                        </div>
                        
                        <!-- 其他数据源结果内容 -->
                        <div id="otherMacResultsContent">
                            <!-- 加载状态 -->
                            <div id="otherMacQueryLoading" class="text-center py-12 text-neutral">
                                <i class="fa fa-circle-o-notch fa-spin text-neutral text-2xl mb-4"></i>
                                <p class="text-neutral">正在查询其他数据源，请稍候...</p>
                            </div>
                            
                            <!-- 结果将通过JavaScript动态生成 -->
                            <div id="otherMacQueryResultsList" class="space-y-6 hidden">
                                <!-- 结果列表将通过JS动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- 隐私环境摘要区域 -->
        <div class="mb-8 space-y-6">
            <div class="bg-white rounded-xl p-6 card-shadow fade-in">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fa fa-shield text-primary mr-2"></i>
                    隐私环境摘要
                </h2>

                <!-- 信息来源说明 -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">信息来源说明：</h4>
                    <div class="flex flex-wrap gap-x-6 gap-y-2 text-sm">
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 rounded-full bg-blue-500 mr-2" title="UA解析"></span>
                            <span>UA解析</span>
                        </div>
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-2" title="JS API"></span>
                            <span>JS API</span>
                        </div>
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 rounded-full bg-purple-500 mr-2" title="计算分析"></span>
                            <span>计算分析</span>
                        </div>
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 rounded-full bg-orange-500 mr-2" title="需授权"></span>
                            <span>需授权</span>
                        </div>
                        <div class="flex items-center">
                            <span class="inline-block w-3 h-3 rounded-full bg-gray-400 mr-2" title="实验性"></span>
                            <span>实验性</span>
                        </div>
                    </div>
                </div>

                <!-- 加载状态 -->
                <div id="privacyLoading" class="text-center py-12 text-neutral">
                    <i class="fa fa-circle-o-notch fa-spin text-neutral text-2xl mb-4"></i>
                    <p class="text-neutral">正在加载环境信息，请稍候...</p>
                </div>

                <!-- 错误状态 -->
                <div id="privacyError" class="text-center py-12 text-neutral hidden">
                    <i class="fa fa-exclamation-circle text-danger text-2xl mb-4"></i>
                    <p id="privacyErrorMessage" class="text-danger">无法获取环境信息，请稍后重试</p>
                </div>

                <!-- 结果内容 -->
                <div id="privacyContent" class="hidden">
                    <!-- 信息分类展示 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- 系统信息 -->
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                <i class="fa fa-desktop text-primary mr-2"></i>
                                系统信息
                            </h3>
                            <div id="systemInfo" class="space-y-3">
                                <!-- 系统信息将通过JS动态生成 -->
                            </div>
                        </div>

                        <!-- 浏览器信息 -->
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                <i class="fa fa-internet-explorer text-primary mr-2"></i>
                                浏览器信息
                            </h3>
                            <div id="browserInfo" class="space-y-3">
                                <!-- 浏览器信息将通过JS动态生成 -->
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- 设备信息 -->
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                <i class="fa fa-mobile text-primary mr-2"></i>
                                设备信息
                            </h3>
                            <div id="deviceInfo" class="space-y-3">
                                <!-- 设备信息将通过JS动态生成 -->
                            </div>
                        </div>

                        <!-- 网络信息 -->
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                <i class="fa fa-wifi text-primary mr-2"></i>
                                网络信息
                            </h3>
                            <div id="networkInfo" class="space-y-3">
                                <!-- 网络信息将通过JS动态生成 -->
                            </div>
                        </div>
                    </div>

                    <!-- 媒体与硬件信息 和 位置信息 并排显示 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- 媒体与硬件信息 -->
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                <i class="fa fa-microchip text-primary mr-2"></i>
                                媒体与硬件信息
                            </h3>
                            <div id="hardwareInfo" class="space-y-3">
                                <!-- 媒体与硬件信息将通过JS动态生成 -->
                            </div>
                        </div>

                        <!-- 位置信息 -->
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-medium text-gray-800 mb-4 flex items-center">
                                <i class="fa fa-map-marker text-primary mr-2"></i>
                                位置信息
                            </h3>
                            <div id="locationInfo" class="space-y-3">
                                <div class="flex items-center">
                                    <button id="getLocationBtn" onclick="getGeolocation()" 
                                            class="bg-primary text-white px-4 py-2 rounded-lg btn-hover inline-flex items-center">
                                        <i class="fa fa-location-arrow mr-2"></i>
                                        获取位置信息（需授权）
                                    </button>
                                    <div id="locationStatus" class="ml-4 text-gray-500 text-sm"></div>
                                </div>
                                <div id="locationDetails" class="hidden mt-3 pl-2 border-l-2 border-gray-200">
                                    <!-- 位置信息将通过JS动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 原始头信息（可折叠） -->
                    <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium text-gray-800 flex items-center">
                                <i class="fa fa-code text-primary mr-2"></i>
                                请求头信息
                            </h3>
                            <button id="toggleHeadersBtn" onclick="toggleRawHeaders()" 
                                    class="text-primary text-sm font-medium flex items-center btn-hover">
                                <span id="toggleHeadersText">显示详情</span>
                                <i id="toggleHeadersIcon" class="fa fa-chevron-down ml-1 text-xs"></i>
                            </button>
                        </div>
                        <div id="rawHeadersContainer" class="hidden mt-4 p-4 bg-white rounded-lg border border-gray-200 text-sm overflow-x-auto">
                            <pre id="rawHeadersContent" class="font-mono whitespace-pre-wrap"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- 官方平台链接区域 -->
        <div class="mb-8 space-y-6">
            <div class="bg-white rounded-xl p-6 card-shadow fade-in">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i class="fa fa-link text-primary mr-2"></i>
                    官方平台链接
                </h2>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- 工信部ICP备案查询 -->
                    <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" 
                       class="group bg-gray-50 rounded-lg p-5 border border-gray-200 hover:border-primary transition-all duration-300 flex flex-col h-full">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-primary mr-3 group-hover:bg-primary group-hover:text-white transition-all duration-300">
                                <i class="fa fa-shield"></i>
                            </div>
                            <h3 class="font-medium text-gray-800">工信部ICP备案</h3>
                        </div>
                        <p class="text-sm text-gray-500 flex-1">查询网站备案信息、备案主体及接入服务商</p>
                    </a>
                    
                    <!-- CNNIC -->
                    <a href="https://www.cnnic.cn/" target="_blank" rel="noopener noreferrer" 
                       class="group bg-gray-50 rounded-lg p-5 border border-gray-200 hover:border-primary transition-all duration-300 flex flex-col h-full">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600 mr-3 group-hover:bg-green-600 group-hover:text-white transition-all duration-300">
                                <i class="fa fa-search"></i>
                            </div>
                            <h3 class="font-medium text-gray-800">CNNIC</h3>
                        </div>
                        <p class="text-sm text-gray-500 flex-1">查询国内域名注册信息、WHOIS信息及DNS解析</p>
                    </a>
                    
                    <!-- ICANN -->
                    <a href="https://www.icann.org/" target="_blank" rel="noopener noreferrer" 
                       class="group bg-gray-50 rounded-lg p-5 border border-gray-200 hover:border-primary transition-all duration-300 flex flex-col h-full">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 mr-3 group-hover:bg-purple-600 group-hover:text-white transition-all duration-300">
                                <i class="fa fa-search"></i>
                            </div>
                            <h3 class="font-medium text-gray-800">ICANN</h3>
                        </div>
                        <p class="text-sm text-gray-500 flex-1">查询全球域名注册信息、WHOIS数据及域名状态</p>
                    </a>
                    
                    <!-- ARIN IP查询 -->
                    <a href="https://www.arin.net/" target="_blank" rel="noopener noreferrer" 
                       class="group bg-gray-50 rounded-lg p-5 border border-gray-200 hover:border-primary transition-all duration-300 flex flex-col h-full">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-600 mr-3 group-hover:bg-amber-600 group-hover:text-white transition-all duration-300">
                                <i class="fa fa-search"></i>
                            </div>
                            <h3 class="font-medium text-gray-800">ARIN</h3>
                        </div>
                        <p class="text-sm text-gray-500 flex-1">查询IP地址归属、网络所有者及注册信息</p>
                    </a>
                </div>
            </div>
        </div>
    

    </div>


    <script>

        // =============================
        // 启动和初始化区域
        // =============================

        // 配置数据将从外部JSON文件加载
        let checkConfigs = [];
        // 存储Ping检测网站配置
        let pingSiteConfigs = [];
        // 存储IP/域名信息查询API配置
        let ipInfoApiConfigs = [];
        // 存储MAC地址信息查询API配置
        let macInfoApiConfigs = [];


        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {

            // 处理本站数据源
            handleCnfaqData();

            // 从JSON文件异步加载配置，覆盖checkConfigs
            loadMyIpConfig();

            // 加载Ping检测网站配置
            loadPingSitesConfig();

            // 加载IP/域名信息查询API配置
            loadIpInfoApiConfig();

            // 加载MAC地址信息查询API配置
            loadMacInfoApiConfig();

            // 加载隐私环境信息
            loadPrivacyEnvironmentInfo();

            // 为Ping检测输入框添加回车事件
            const pingInput = document.getElementById('pingTarget');
            if (pingInput) {
                pingInput.addEventListener('keydown', function(event) {
                    // 检查是否按下回车键
                    if (event.key === 'Enter' || event.keyCode === 13) {
                        event.preventDefault(); // 阻止默认行为（如表单提交）
                        startPingCheck(); // 触发Ping检测
                    }
                });
            }

            // 为IP/域名查询输入框添加回车事件
            const queryInput = document.getElementById('ipDomainQuery');
            if (queryInput) {
                queryInput.addEventListener('keydown', function(event) {
                    // 检查是否按下回车键
                    if (event.key === 'Enter' || event.keyCode === 13) {
                        event.preventDefault(); // 阻止默认行为
                        startIpDomainQuery(); // 触发查询操作
                    }
                });
            }

            // 为MAC地址查询输入框添加回车事件
            const macInput = document.getElementById('macAddressQuery');
            if (macInput) {
                macInput.addEventListener('keydown', function(event) {
                    // 检查是否按下回车键
                    if (event.key === 'Enter' || event.keyCode === 13) {
                        event.preventDefault(); // 阻止默认行为
                        startIeeeMacQuery(); // 触发查询操作
                    }
                });
            }

        });


        // 加载我的IP的API配置
        function loadMyIpConfig() {
            fetch('my_ip_api_config.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`配置文件加载失败: ${response.status}`);
                    }
                    return response.json();
                })
                .then(configs => {
                    checkConfigs = configs;
                })
                .catch(err => {
                    console.error('加载配置文件出错:', err);

                    const container = document.getElementById('sourcesContainer');
                    container.innerHTML = `
                        <div class="bg-white rounded-xl p-6 text-center card-shadow fade-in">
                            <i class="fa fa-exclamation-circle text-danger text-2xl mb-4"></i>
                            <p class="text-danger">配置文件加载失败，请检查my_ip_api_config.json是否存在</p>
                            <p class="text-neutral text-sm mt-2">错误信息: ${err.message}</p>
                        </div>
                    `;
                });
        }


        // 加载Ping检测网站配置
        function loadPingSitesConfig() {
            fetch('ip_ping_site_config.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Ping检测网站配置加载失败: ${response.status}`);
                    }
                    return response.json();
                })
                .then(configs => {
                    pingSiteConfigs = configs;
                    renderPingSites();
                })
                .catch(err => {
                    console.error('加载Ping检测网站配置出错:', err);

                    const loadingIndicator = document.getElementById('pingSitesLoading');
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = `
                            <i class="fa fa-exclamation-circle text-danger text-xl mb-2"></i>
                            <p class="text-danger text-sm">配置文件加载失败，请检查ip_ping_site_config.json是否存在</p>
                            <p class="text-neutral text-xs mt-1">错误信息: ${err.message}</p>
                        `;
                    }
                });
        }


        // 加载IP/域名信息查询API配置
        function loadIpInfoApiConfig() {
            fetch('ip_info_api_config.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`IP信息API配置加载失败: ${response.status}`);
                    }
                    return response.json();
                })
                .then(configs => {
                    ipInfoApiConfigs = configs;
                })
                .catch(err => {
                    console.error('加载IP信息API配置出错:', err);
                    showNotification('IP信息查询功能初始化失败', false);
                });
        }


        // 加载MAC地址信息查询API配置
        function loadMacInfoApiConfig() {
            fetch('mac_info_api_config.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`MAC信息API配置加载失败: ${response.status}`);
                    }
                    return response.json();
                })
                .then(configs => {
                    macInfoApiConfigs = configs;
                })
                .catch(err => {
                    console.error('加载MAC信息API配置出错:', err);
                    showNotification('MAC信息查询功能初始化失败', false);
                });
        }


        // =============================
        // 我的IP 业务逻辑处理
        // =============================


        // 处理本站数据源
        function handleCnfaqData() {
            // 处理IPv4
            Promise.resolve(window.cnfaqV4Promise).then(ip => {
                if (ip && isIPv4(ip)) {
                    setResult('cnfaqV4Ip', ip);
                    showNotification('IPv4地址已更新', true);
                } else {
                    setNoData('cnfaqV4Ip', '无IPv4地址');
                }
            });

            // 处理IPv6
            Promise.resolve(window.cnfaqV6Promise).then(ip => {
                if (ip && isIPv6(ip)) {
                    setResult('cnfaqV6Ipv6', ip);
                    showNotification('IPv6地址已更新', true);
                } else {
                    setNoData('cnfaqV6Ipv6', '无IPv6地址');
                }
            });
        }


        // 置顶显示的IP的刷新函数
        function refreshIPv4() {
            unifiedCheck('cnfaqV4');
        }

        function refreshIPv6() {
            unifiedCheck('cnfaqV6');
        }


        // 显示/隐藏所有数据源
        function toggleAllSourcesHandler() {
            const container = document.getElementById('sourcesContainer');
            const button = document.getElementById('toggleAllSources');
            const buttonText = button.querySelector('span');
            const buttonIcon = button.querySelector('i');

            if (container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                buttonText.textContent = '隐藏所有数据源';
                buttonIcon.className = 'fa fa-chevron-up mr-2';

                // 如果是第一次显示，渲染所有数据源
                if (container.innerHTML.includes('正在加载所有数据源')) {
                    renderSources();
                    // 加载所有数据源数据
                    checkConfigs.forEach(config => {
                        if (config.id !== 'cnfaqV4' && config.id !== 'cnfaqV6') {
                            unifiedCheck(config.id);
                        }
                    });
                }
            } else {
                container.classList.add('hidden');
                buttonText.textContent = '显示所有数据源';
                buttonIcon.className = 'fa fa-list-alt mr-2';
            }
        }


        // 生成所有数据源的展示区域
        function renderSources() {
            const container = document.getElementById('sourcesContainer');
            container.innerHTML = ''; // 清空加载提示


            checkConfigs.forEach(config => {
                // 跳过本站数据源，已经在主区域显示
                if (config.id === 'cnfaqV4' || config.id === 'cnfaqV6') {
                    return;
                }


                const ids = getElementIds(config.id);


                // 创建主卡片容器
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl overflow-hidden card-shadow fade-in';


                // 主信息行HTML
                const mainContent = `
                    <div class="p-6">
                        <div class="grid grid-cols-12 gap-4 items-center">
                            <!-- 源名称和刷新按钮 -->
                            <div class="col-span-12 md:col-span-3 flex items-center">
                                <span class="font-semibold text-gray-800 mr-2">${config.name}</span>
                                <button onclick="unifiedCheck('${config.id}')" class="text-neutral btn-hover" title="刷新">
                                    <i class="fa fa-refresh"></i>
                                </button>
                            </div>


                            <!-- IPv4地址 -->
                            <div class="col-span-12 md:col-span-3 flex items-center">
                                <span id="${ids.resultElements.ipv4}" class="font-mono break-all flex-1 text-right">-</span>
                                <button id="copy${capitalizeFirstLetter(ids.resultElements.ipv4)}"
                                        onclick="copyToClipboard(document.getElementById('${ids.resultElements.ipv4}').textContent)"
                                        class="ml-1 text-neutral btn-hover hidden" title="复制">
                                    <i class="fa fa-copy"></i>
                                </button>
                            </div>


                            <!-- IPv6地址 -->
                            <div class="col-span-12 md:col-span-3 flex items-center">
                                <span id="${ids.resultElements.ipv6}" class="font-mono break-all flex-1 text-right">-</span>
                                <button id="copy${capitalizeFirstLetter(ids.resultElements.ipv6)}"
                                        onclick="copyToClipboard(document.getElementById('${ids.resultElements.ipv6}').textContent)"
                                        class="ml-1 text-neutral btn-hover hidden" title="复制">
                                    <i class="fa fa-copy"></i>
                                </button>
                            </div>


                            <!-- 展开/收起按钮 -->
                            <div class="col-span-12 md:col-span-3 flex justify-end">
                                <button id="${ids.detailsBtnId}"
                                        onclick="toggleDetails('${ids.detailsId}', '${ids.btnTextId}', '${ids.btnIconId}')"
                                        class="text-primary text-sm font-medium flex items-center btn-hover">
                                    <span id="${ids.btnTextId}">查看详情</span>
                                    <i id="${ids.btnIconId}" class="fa fa-chevron-down ml-1 text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- 详细信息 -->
                    <div id="${ids.detailsId}" class="hidden bg-gray-50 p-6 border-t border-gray-100 fade-in">
                        <h4 class="font-medium text-gray-700 mb-4">详细信息</h4>
                        <table class="min-w-full divide-y divide-gray-200">
                            <tbody id="${ids.detailsTableId}" class="divide-y divide-gray-200">
                                <!-- 详细信息将通过JS动态填充 -->
                            </tbody>
                        </table>
                    </div>
                `;


                card.innerHTML = mainContent;
                container.appendChild(card);
            });
        }


        // 展开/收起详情功能
        function toggleDetails(detailsId, btnTextId, btnIconId) {
            const detailsElement = document.getElementById(detailsId);
            const btnTextElement = document.getElementById(btnTextId);
            const btnIconElement = document.getElementById(btnIconId);


            if (!detailsElement || !btnTextElement || !btnIconElement) return;


            const isHidden = detailsElement.classList.contains('hidden');


            // 切换显示状态
            if (isHidden) {
                detailsElement.classList.remove('hidden');
            } else {
                detailsElement.classList.add('hidden');
            }


            // 更新按钮文本和图标
            btnTextElement.textContent = isHidden ? '收起详情' : '查看详情';
            btnIconElement.className = isHidden ? 'fa fa-chevron-up ml-1 text-xs' : 'fa fa-chevron-down ml-1 text-xs';
        }


        // =============================
        // Ping检测 业务逻辑处理
        // =============================


        // 开始Ping检测
        function startPingCheck() {
            const inputElement = document.getElementById('pingTarget');
            const rawTarget = inputElement.value.trim();

            if (!rawTarget) {
                showNotification('请输入IP地址或域名', false);
                inputElement.focus();
                return;
            }

            // 1. 首先获取类型
            const targetType = determineInputType(rawTarget);

            // 2. 根据类型处理实际值
            let targetValue;
            if (targetType === 'domain') {
                targetValue = normalizeDomain(rawTarget);
            } else {
                targetValue = rawTarget;  // IP类型直接使用原始输入
            }

            // 收集选中的且支持该类型的网站
            const selectedSites = pingSiteConfigs.filter(site => {
                const isChecked = document.getElementById(`pingSite_${site.id}`)?.checked;
                const supportsType = (targetType === 'ipv4' && site.ipv4) ||
                                    (targetType === 'ipv6' && site.ipv6) ||
                                    (targetType === 'domain' && site.domain);

                return isChecked && supportsType;
            });

            if (selectedSites.length === 0) {
                showNotification('没有找到支持该类型的选中网站', false);
                return;
            }

            // 打开每个选中网站的检测页面
            selectedSites.forEach(site => {
                const url = site.url.replace('$ip', encodeURIComponent(targetValue));
                window.open(url, '_blank');
            });

            showNotification(`已在新窗口打开 ${selectedSites.length} 个检测页面`);
        }


        // 渲染Ping检测网站选项
        function renderPingSites() {
            const container = document.getElementById('pingSitesList');
            const loadingIndicator = document.getElementById('pingSitesLoading');

            // 移除加载提示
            if (loadingIndicator && loadingIndicator.parentNode === container) {
                container.removeChild(loadingIndicator);
            }

            if (pingSiteConfigs.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.className = 'col-span-full text-center py-8 text-neutral';
                emptyMessage.innerHTML = '<p>未找到可用的检测网站配置</p>';
                container.appendChild(emptyMessage);
                return;
            }

            pingSiteConfigs.forEach(site => {
                const siteItem = document.createElement('div');
                siteItem.className = 'flex items-center p-3 border border-gray-100 rounded-lg bg-gray-50';

                // 构建支持类型的显示文本
                const supportedTypes = [];
                if (site.ipv4) supportedTypes.push('IPv4');
                if (site.ipv6) supportedTypes.push('IPv6');
                if (site.domain) supportedTypes.push('域名');

                siteItem.innerHTML = `
                    <input
                        type="checkbox"
                        id="pingSite_${site.id}"
                        class="mr-3 h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded ping-site-checkbox"
                        checked
                    >
                    <label for="pingSite_${site.id}" class="flex-1 cursor-pointer">
                        <div class="font-medium text-gray-800">${site.name}</div>
                        <div class="text-xs text-gray-500">支持: ${supportedTypes.join(', ')}</div>
                    </label>
                `;

                container.appendChild(siteItem);
            });
        }


        // 切换Ping检测网站列表的显示/隐藏状态
        function togglePingSites() {
            const listContainer = document.getElementById('pingSitesList');
            const btnText = document.getElementById('pingSitesBtnText');
            const btnIcon = document.getElementById('pingSitesBtnIcon');

            const isHidden = listContainer.classList.contains('hidden');

            if (isHidden) {
                listContainer.classList.remove('hidden');
                btnText.textContent = '收起检测网站选择';
                btnIcon.className = 'fa fa-chevron-up ml-1 text-xs';
            } else {
                listContainer.classList.add('hidden');
                btnText.textContent = '选择检测网站（默认全部）';
                btnIcon.className = 'fa fa-chevron-down ml-1 text-xs';
            }
        }


        // 全选所有网站
        function selectAllSites() {
            if (!pingSiteConfigs || pingSiteConfigs.length === 0) return;

            let count = 0;
            pingSiteConfigs.forEach(site => {
                const checkbox = document.getElementById(`pingSite_${site.id}`);
                if (checkbox) {
                    checkbox.checked = true;
                    count++;
                }
            });

            showNotification(`已全选 ${count} 个检测网站`);
        }


        // 取消所有勾选
        function clearAllChecks() {
            if (!pingSiteConfigs || pingSiteConfigs.length === 0) return;

            pingSiteConfigs.forEach(site => {
                const checkbox = document.getElementById(`pingSite_${site.id}`);
                if (checkbox) {
                    checkbox.checked = false;
                }
            });

            showNotification('已取消所有网站勾选');
        }


        // 仅勾选支持IPv4的网站
        function selectOnlyIPv4() {
            if (!pingSiteConfigs || pingSiteConfigs.length === 0) return;

            let count = 0;
            pingSiteConfigs.forEach(site => {
                const checkbox = document.getElementById(`pingSite_${site.id}`);
                if (checkbox) {
                    const shouldCheck = site.ipv4 === true;
                    checkbox.checked = shouldCheck;
                    if (shouldCheck) count++;
                }
            });

            showNotification(`已勾选 ${count} 个IPv4检测网站`);
        }


        // 仅勾选支持IPv6的网站
        function selectOnlyIPv6() {
            if (!pingSiteConfigs || pingSiteConfigs.length === 0) return;

            let count = 0;
            pingSiteConfigs.forEach(site => {
                const checkbox = document.getElementById(`pingSite_${site.id}`);
                if (checkbox) {
                    const shouldCheck = site.ipv6 === true;
                    checkbox.checked = shouldCheck;
                    if (shouldCheck) count++;
                }
            });

            showNotification(`已勾选 ${count} 个IPv6检测网站`);
        }


        // =============================
        // IP/域名信息查询 业务逻辑处理
        // =============================


        // 开始IP/域名信息查询
        function startIpDomainQuery() {
            const inputElement = document.getElementById('ipDomainQuery');
            const rawTarget = inputElement.value.trim();

            if (!rawTarget) {
                showNotification('请输入IP地址或域名', false);
                inputElement.focus();
                return;
            }

            // 显示结果容器
            const resultsContainer = document.getElementById('queryResultsContainer');
            resultsContainer.classList.remove('hidden');

            // 显示加载状态，隐藏结果列表
            document.getElementById('queryLoading').classList.remove('hidden');
            document.getElementById('queryResultsList').classList.add('hidden');

            // 显示查询目标
            document.getElementById('queryTargetDisplay').textContent = `(${rawTarget})`;

            // 判断输入类型
            const targetType = determineInputType(rawTarget);
            let targetValue = rawTarget;

            // 格式化域名
            if (targetType === 'domain') {
                targetValue = normalizeDomain(rawTarget);
            }

            // 筛选支持该类型的API
            const supportedApis = ipInfoApiConfigs.filter(api => {
                return (targetType === 'ipv4' && api.ipv4) ||
                       (targetType === 'ipv6' && api.ipv6) ||
                       (targetType === 'domain' && api.domain);
            });

            if (supportedApis.length === 0) {
                document.getElementById('queryLoading').classList.add('hidden');
                document.getElementById('queryResultsList').innerHTML = `
                    <div class="text-center py-12 text-neutral">
                        <i class="fa fa-info-circle text-neutral text-2xl mb-4"></i>
                        <p class="text-neutral">没有找到支持该类型的查询API</p>
                    </div>
                `;
                document.getElementById('queryResultsList').classList.remove('hidden');
                return;
            }

            // 清空结果列表，只保留表头
            const resultsList = document.getElementById('queryResultsList');
            // 只保留表头部分
            const header = `<div class="grid grid-cols-10 gap-2 p-3 bg-gray-100 rounded-lg font-medium text-sm">
                <div class="col-span-12 md:col-span-2">来源</div>
                <div class="col-span-12 md:col-span-2">综合信息</div>
                <div class="col-span-12 md:col-span-2">Whois查询</div>
                <div class="col-span-12 md:col-span-2">DNS解析</div>
                <div class="col-span-12 md:col-span-2">其他信息</div>
            </div>`;
            resultsList.innerHTML = header;

            // 对每个支持的API发起查询
            supportedApis.forEach(api => {
                // 创建API结果行容器
                const apiResultId = `apiResult_${api.id}`;
                const apiResultElement = document.createElement('div');
                apiResultElement.id = apiResultId;
                apiResultElement.className = 'space-y-2';

                // 构建API结果行
                apiResultElement.innerHTML = `
                    <!-- API结果行 -->
                    <div class="grid grid-cols-10 gap-2 p-3 bg-white rounded-lg border border-gray-100">
                        <!-- API名称 -->
                        <div class="col-span-12 md:col-span-2 flex items-center">
                            <i class="fa fa-database text-primary mr-2"></i>
                            <span class="font-medium text-gray-800">${api.name}</span>
                        </div>

                        <!-- 综合信息 -->
                        <div class="col-span-12 md:col-span-2" id="${apiResultId}_info_container"></div>

                        <!-- Whois查询 -->
                        <div class="col-span-12 md:col-span-2" id="${apiResultId}_whois_container"></div>

                        <!-- DNS解析 -->
                        <div class="col-span-12 md:col-span-2" id="${apiResultId}_dns_container"></div>

                        <!-- 其他信息 -->
                        <div class="col-span-12 md:col-span-2" id="${apiResultId}_trace_container"></div>
                    </div>

                    <!-- 详情展示区域 -->
                    <div id="${apiResultId}_details" class="col-span-12 ml-2 md:ml-0"></div>
                `;

                resultsList.appendChild(apiResultElement);

                // 处理各类查询
                const apiUrl = encodeURIComponent(targetValue);

                // 综合信息查询
                if (api.info !== null) {
                    createQuerySection(
                        document.getElementById(`${apiResultId}_info_container`),
                        document.getElementById(`${apiResultId}_details`),
                        targetValue,
                        api.id,
                        'info',
                        '综合信息',
                        api.info.url.replace('$ip', apiUrl),
                        api.info.postParams,
                        api.info.responseType,
                        api.info.data,
                        api.info.selectors,
                        api.info.excludeFields || []
                    );
                } else {
                    addUnsupportedSection(document.getElementById(`${apiResultId}_info_container`), 'info', '综合信息');
                }

                // Whois查询
                if (api.whois !== null) {
                    createQuerySection(
                        document.getElementById(`${apiResultId}_whois_container`),
                        document.getElementById(`${apiResultId}_details`),
                        targetValue,
                        api.id,
                        'whois',
                        'Whois查询',
                        api.whois.url.replace('$ip', apiUrl),
                        api.whois.postParams,
                        api.whois.responseType,
                        api.whois.data,
                        api.whois.selectors,
                        api.whois.excludeFields || []
                    );
                } else {
                    addUnsupportedSection(document.getElementById(`${apiResultId}_whois_container`), 'whois', 'Whois查询');
                }

                // DNS解析查询
                if (api.dns !== null) {
                    createQuerySection(
                        document.getElementById(`${apiResultId}_dns_container`),
                        document.getElementById(`${apiResultId}_details`),
                        targetValue,
                        api.id,
                        'dns',
                        'DNS解析',
                        api.dns.url.replace('$ip', apiUrl),
                        api.dns.postParams,
                        api.dns.responseType,
                        api.dns.data,
                        api.dns.selectors,
                        api.dns.excludeFields || []
                    );
                } else {
                    addUnsupportedSection(document.getElementById(`${apiResultId}_dns_container`), 'dns', 'DNS解析');
                }

                // 其他信息查询
                if (api.trace !== null) {
                    createQuerySection(
                        document.getElementById(`${apiResultId}_trace_container`),
                        document.getElementById(`${apiResultId}_details`),
                        targetValue,
                        api.id,
                        'trace',
                        '其他信息',
                        api.trace.url.replace('$ip', apiUrl),
                        api.trace.postParams,
                        api.trace.responseType,
                        api.trace.data,
                        api.trace.selectors,
                        api.trace.excludeFields || []
                    );
                } else {
                    addUnsupportedSection(document.getElementById(`${apiResultId}_trace_container`), 'trace', '其他信息');
                }
            });

            // 隐藏加载状态，显示结果列表
            setTimeout(() => {
                document.getElementById('queryLoading').classList.add('hidden');
                document.getElementById('queryResultsList').classList.remove('hidden');
            }, 500);
        }


        // 添加不支持的部分
        function addUnsupportedSection(parent, type, title) {
            const section = document.createElement('div');
            section.className = 'unsupported rounded p-2 border border-gray-200 flex items-center';
            section.innerHTML = `
                <i class="fa fa-ban text-gray-400 mr-2"></i>
                <span class="text-gray-400">不支持</span>
            `;

            parent.appendChild(section);
        }


        // 切换查询结果的展开/收起
        function toggleQueryResults() {
            const content = document.getElementById('queryResultsContent');
            const btnText = document.getElementById('toggleResultsText');
            const btnIcon = document.getElementById('toggleResultsIcon');

            const isHidden = content.classList.contains('hidden');

            if (isHidden) {
                content.classList.remove('hidden');
                btnText.textContent = '收起结果';
                btnIcon.className = 'fa fa-chevron-up ml-1 text-xs';
            } else {
                content.classList.add('hidden');
                btnText.textContent = '展开结果';
                btnIcon.className = 'fa fa-chevron-down ml-1 text-xs';
            }
        }


        // =============================
        // MAC地址信息查询 业务逻辑处理
        // =============================


        // 开始IEEE MAC地址查询（仅本站数据源）
        function startIeeeMacQuery() {
            const inputElement = document.getElementById('macAddressQuery');
            const rawMac = inputElement.value.trim();

            if (!rawMac) {
                showNotification('请输入MAC地址', false);
                inputElement.focus();
                return;
            }

            // 验证MAC地址格式
            if (!isValidMacAddress(rawMac)) {
                showNotification('请输入有效的MAC地址，格式如 00:1B:44:11:3A:B7 或 00-1B-44-11-3A-B7', false);
                inputElement.focus();
                return;
            }

            // 标准化MAC地址格式（统一为冒号分隔）
            const normalizedMac = normalizeMacAddress(rawMac);
            // 提取前6位（去除冒号）
            const macPrefix = normalizedMac.replace(/:/g, '').substring(0, 6).toUpperCase();

            // 显示结果容器
            const resultsContainer = document.getElementById('macQueryResultsContainer');
            resultsContainer.classList.remove('hidden');

            // 显示查询目标
            document.getElementById('macQueryTargetDisplay').textContent = `(${normalizedMac})`;

            // 隐藏其他数据源结果
            document.getElementById('otherMacSourcesResults').classList.add('hidden');

            // 显示加载状态，隐藏结果和错误
            document.getElementById('ieeeLoading').classList.remove('hidden');
            document.getElementById('ieeeResultContent').classList.add('hidden');
            document.getElementById('ieeeError').classList.add('hidden');

            // 尝试从缓存获取数据
            const cachedData = getCachedOuiData();
            if (cachedData) {
                // 使用缓存数据解析
                parseOuiData(cachedData, macPrefix);
                return;
            }

            // 缓存不存在，从本站获取数据
            fetch('https://cnfaq.cn/py/get-ieee-oui.do')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(data => {
                    // 缓存数据，设置有效期为7天
                    cacheOuiData(data);
                    // 解析数据
                    parseOuiData(data, macPrefix);
                })
                .catch(err => {
                    console.error('获取本站IEEE OUI数据失败:', err);
                    // 显示错误状态
                    document.getElementById('ieeeLoading').classList.add('hidden');
                    document.getElementById('ieeeError').classList.remove('hidden');
                    document.getElementById('ieeeErrorMessage').textContent = '无法获取本站数据，请稍后重试';
                });
        }


        // 从缓存获取OUI数据（带解压）
        function getCachedOuiData() {
            try {
                const cached = localStorage.getItem('ouiData');
                if (!cached) return null;

                // 解压数据
                const compressedData = atob(cached);
                const uint8Array = new Uint8Array(compressedData.length);
                for (let i = 0; i < compressedData.length; i++) {
                    uint8Array[i] = compressedData.charCodeAt(i);
                }
                const decompressed = pako.inflate(uint8Array, { to: 'string' });
                const parsed = JSON.parse(decompressed);

                // 检查缓存是否过期（7天有效期）
                const sevenDays = 7 * 24 * 60 * 60 * 1000;
                if (Date.now() - parsed.timestamp < sevenDays) {
                    return parsed.data;
                }

                // 缓存过期，清除
                localStorage.removeItem('ouiData');
                return null;
            } catch (e) {
                console.error('获取缓存OUI数据失败:', e);
                localStorage.removeItem('ouiData');
                return null;
            }
        }

        // 缓存OUI数据（带压缩）
        function cacheOuiData(data) {
            try {
                // 准备要存储的数据
                const dataToStore = JSON.stringify({
                    timestamp: Date.now(),
                    data: data
                });

                // 压缩数据
                const compressed = pako.deflate(dataToStore, { level: 6 });
                let base64String = '';
                const uint8Array = new Uint8Array(compressed);
                for (let i = 0; i < uint8Array.length; i++) {
                    base64String += String.fromCharCode(uint8Array[i]);
                }
                const encoded = btoa(base64String);

                // 存储到localStorage
                localStorage.setItem('ouiData', encoded);
            } catch (e) {
                console.error('缓存OUI数据失败:', e);
            }
        }


        // 解析OUI数据并提取信息
        function parseOuiData(data, macPrefix) {
            // 隐藏加载状态
            document.getElementById('ieeeLoading').classList.add('hidden');

            try {
                // 分割成行为单位
                const lines = data.split('\n');
                let organization = null;
                let addressLines = [];
                let found = false;

                // 遍历查找MAC前缀
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // 查找base 16格式的MAC前缀
                    if (line.startsWith(macPrefix) && line.includes('(base 16)')) {
                        found = true;
                        // 提取组织名（去除MAC前缀和(base 16)部分）
                        organization = line.replace(macPrefix, '').replace('(base 16)', '').trim();
                        
                        // 提取地址（接下来的非空行）
                        let j = i + 1;
                        while (j < lines.length) {
                            const addressLine = lines[j].trim();
                            if (addressLine === '') break; // 遇到空行停止
                            
                            // 检查是否是下一个MAC条目（如果行包含(hex)或(base 16)）
                            if (addressLine.includes('(hex)') || addressLine.includes('(base 16)')) {
                                break;
                            }
                            
                            addressLines.push(addressLine);
                            j++;
                        }
                        break;
                    }
                }

                if (found && organization) {
                    // 显示结果
                    document.getElementById('ieeeOrganization').textContent = organization;
                    
                    // 格式化地址为一行，使用逗号分隔
                    const formattedAddress = addressLines.join(', ');
                    document.getElementById('ieeeAddress').textContent = formattedAddress;
                    
                    document.getElementById('ieeeResultContent').classList.remove('hidden');
                } else {
                    // 未找到匹配的MAC前缀
                    document.getElementById('ieeeError').classList.remove('hidden');
                    document.getElementById('ieeeErrorMessage').textContent = '未找到匹配的MAC地址信息';
                }
            } catch (e) {
                console.error('解析OUI数据失败:', e);
                document.getElementById('ieeeError').classList.remove('hidden');
                document.getElementById('ieeeErrorMessage').textContent = '解析数据失败，请稍后重试';
            }
        }


        // 查询所有MAC数据源
        function startAllMacSourcesQuery() {
            const inputElement = document.getElementById('macAddressQuery');
            const rawMac = inputElement.value.trim();

            if (!rawMac) {
                showNotification('请输入MAC地址', false);
                inputElement.focus();
                return;
            }

            // 标准化MAC地址格式
            const normalizedMac = normalizeMacAddress(rawMac);

            // 显示其他数据源结果区域
            document.getElementById('otherMacSourcesResults').classList.remove('hidden');

            // 显示加载状态，隐藏结果列表
            document.getElementById('otherMacQueryLoading').classList.remove('hidden');
            document.getElementById('otherMacQueryResultsList').classList.add('hidden');

            // 检查是否有可用的API配置
            if (macInfoApiConfigs.length === 0) {
                document.getElementById('otherMacQueryLoading').classList.add('hidden');
                document.getElementById('otherMacQueryResultsList').innerHTML = `
                    <div class="text-center py-12 text-neutral">
                        <i class="fa fa-info-circle text-neutral text-2xl mb-4"></i>
                        <p class="text-neutral">未加载到MAC地址查询API配置</p>
                    </div>
                `;
                document.getElementById('otherMacQueryResultsList').classList.remove('hidden');
                return;
            }

            // 清空结果列表
            const resultsList = document.getElementById('otherMacQueryResultsList');
            resultsList.innerHTML = '';

            // 对每个API发起查询
            macInfoApiConfigs.forEach(api => {
                // 创建API结果容器
                const apiResultId = `macApiResult_${api.id}`;
                const apiResultElement = document.createElement('div');
                apiResultElement.id = apiResultId;
                apiResultElement.className = 'space-y-2';

                // 构建API结果区域
                apiResultElement.innerHTML = `
                    <!-- API结果行 -->
                    <div class="grid grid-cols-8 gap-2 p-3 bg-white rounded-lg border border-gray-100">
                        <!-- API名称 -->
                        <div class="col-span-8 md:col-span-2 flex items-center">
                            <i class="fa fa-database text-primary mr-2"></i>
                            <span class="font-medium text-gray-800">${api.name}</span>
                        </div>
                        <!-- 查看详情 -->
                        <div class="col-span-8 md:col-span-6" id="${apiResultId}_info_container"></div>

                    </div>

                    <!-- 详情展示区域 -->
                    <div id="${apiResultId}_details_container" class="col-span-8 ml-2 md:ml-0"></div>
                `;

                resultsList.appendChild(apiResultElement);

                // 处理查询
                const encodedMac = encodeURIComponent(normalizedMac);
                const apiUrl = api.url.replace('$mac', encodedMac);

                // 创建查询部分
                createQuerySection(
                    document.getElementById(`${apiResultId}_info_container`),
                    document.getElementById(`${apiResultId}_details_container`),
                    normalizedMac,
                    api.id,
                    "info",
                    "点击查看结果详情",
                    apiUrl,
                    api.postParams,
                    api.responseType,
                    api.data,
                    api.selectors,
                    api.excludeFields || []
                );
            });

            // 隐藏加载状态，显示结果列表
            setTimeout(() => {
                document.getElementById('otherMacQueryLoading').classList.add('hidden');
                document.getElementById('otherMacQueryResultsList').classList.remove('hidden');
            }, 500);
        }


        // 切换其他MAC查询结果的展开/收起
        function toggleOtherMacQueryResults() {
            const content = document.getElementById('otherMacResultsContent');
            const btnText = document.getElementById('toggleOtherMacResultsText');
            const btnIcon = document.getElementById('toggleOtherMacResultsIcon');

            const isHidden = content.classList.contains('hidden');

            if (isHidden) {
                content.classList.remove('hidden');
                btnText.textContent = '收起结果';
                btnIcon.className = 'fa fa-chevron-up ml-1 text-xs';
            } else {
                content.classList.add('hidden');
                btnText.textContent = '展开结果';
                btnIcon.className = 'fa fa-chevron-down ml-1 text-xs';
            }
        }


        // =============================
        // 隐私环境摘要 业务逻辑处理
        // =============================


        // 信息来源类型
        const INFO_SOURCE = {
            UA_PARSE: 'ua-parse',      // 蓝色
            JS_API: 'js-api',          // 绿色
            CALCULATED: 'calculated',  // 紫色
            AUTHORIZATION: 'auth',     // 橙色
            EXPERIMENTAL: 'experimental' // 灰色
        };

        // 加载隐私环境信息
        function loadPrivacyEnvironmentInfo() {
            fetch('https://cnfaq.cn/py/request-headers.do')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // 隐藏加载状态，显示内容
                    document.getElementById('privacyLoading').classList.add('hidden');
                    document.getElementById('privacyContent').classList.remove('hidden');
                    
                    // 处理并显示解析后的信息
                    displayParsedInfo(data.parsed_info);
                    
                    // 存储原始头信息
                    document.getElementById('rawHeadersContent').textContent = JSON.stringify(data.raw_headers, null, 2);
                    
                    // 补充详细信息
                    addBrowserDetails();
                    addSystemDetails();
                    addDeviceDetails();
                    addNetworkDetails();
                    addHardwareDetails();
                    
                    // 加载需要异步获取的信息
                    loadAsyncInformation();
                })
                .catch(err => {
                    console.error('获取隐私环境信息失败:', err);
                    // 显示错误状态
                    document.getElementById('privacyLoading').classList.add('hidden');
                    document.getElementById('privacyError').classList.remove('hidden');
                    document.getElementById('privacyErrorMessage').textContent = '无法获取环境信息，请稍后重试';
                });
        }

        // 显示解析后的信息
        function displayParsedInfo(parsedInfo) {
            const systemInfoContainer = document.getElementById('systemInfo');
            const browserInfoContainer = document.getElementById('browserInfo');
            const deviceInfoContainer = document.getElementById('deviceInfo');
            
            // 系统信息 (UA解析)
            addInfoItem(systemInfoContainer, '操作系统', parsedInfo['操作系统'] || '未知', INFO_SOURCE.UA_PARSE);
            addInfoItem(systemInfoContainer, '操作系统版本', parsedInfo['操作系统版本'] || '未知', INFO_SOURCE.UA_PARSE);

            // 浏览器信息 (UA解析)
            addInfoItem(browserInfoContainer, '浏览器', parsedInfo['浏览器'] || '未知', INFO_SOURCE.UA_PARSE);
            addInfoItem(browserInfoContainer, '浏览器版本', parsedInfo['浏览器版本'] || '未知', INFO_SOURCE.UA_PARSE);

            // 设备信息 (UA解析)
            addInfoItem(deviceInfoContainer, '设备类型', parsedInfo['设备'] || '未知', INFO_SOURCE.UA_PARSE);
            addInfoItem(deviceInfoContainer, '是否移动设备', parsedInfo['是否移动设备'] ? '是' : '否', INFO_SOURCE.UA_PARSE);
            addInfoItem(deviceInfoContainer, '是否平板设备', parsedInfo['是否平板设备'] ? '是' : '否', INFO_SOURCE.UA_PARSE);
            addInfoItem(deviceInfoContainer, '是否桌面设备', parsedInfo['是否桌面设备'] ? '是' : '否', INFO_SOURCE.UA_PARSE);
            addInfoItem(deviceInfoContainer, '是否爬虫', parsedInfo['是否爬虫'] ? '是' : '否', INFO_SOURCE.UA_PARSE);
        }

        // 添加浏览器详细信息
        function addBrowserDetails() {
            const browserInfoContainer = document.getElementById('browserInfo');
            
            // 浏览器语言 (JS API)
            let language = '未知';
            try {
                language = navigator.language || navigator.userLanguage || '未知';
            } catch (e) {
                console.log('获取浏览器语言失败:', e);
            }
            addInfoItem(browserInfoContainer, '浏览器语言', language, INFO_SOURCE.JS_API);
            
            // 时区 (JS API)
            try {
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                addInfoItem(browserInfoContainer, '时区', timeZone || '未知', INFO_SOURCE.JS_API);
            } catch (e) {
                addInfoItem(browserInfoContainer, '时区', '未知', INFO_SOURCE.JS_API);
            }
            
            // 是否启用Cookie (JS API)
            let cookieEnabled = '未知';
            try {
                cookieEnabled = navigator.cookieEnabled ? '是' : '否';
            } catch (e) {
                console.log('获取Cookie状态失败:', e);
            }
            addInfoItem(browserInfoContainer, '是否启用Cookie', cookieEnabled, INFO_SOURCE.JS_API);
            
            // DNT（不跟踪）状态 (JS API)
            let doNotTrack = '未知';
            try {
                doNotTrack = navigator.doNotTrack || navigator.msDoNotTrack;
                doNotTrack = (doNotTrack === '1' || doNotTrack === 'yes') ? '启用' : 
                            (doNotTrack === '0' || doNotTrack === 'no') ? '禁用' : '未知';
            } catch (e) {
                console.log('获取DNT状态失败:', e);
            }
            addInfoItem(browserInfoContainer, 'DNT（不跟踪）状态', doNotTrack, INFO_SOURCE.JS_API);
            
            // Service Workers注册状态 (JS API)
            addAsyncInfoItem(browserInfoContainer, 'Service Workers', '获取中...', INFO_SOURCE.JS_API, async () => {
                try {
                    if ('serviceWorker' in navigator) {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        if (registrations.length > 0) {
                            // 详情打印在控制台
                            console.log("Service Worker 注册列表:", registrations);
                            return `已注册 (${registrations.length}个)`;
                        } else {
                            return '未注册';
                        }
                    } else {
                        return '不支持';
                    }
                } catch (e) {
                    return '获取失败';
                }
            });
        }

        // 添加系统详细信息
        function addSystemDetails() {
            const systemInfoContainer = document.getElementById('systemInfo');
            
            // 暗色模式偏好 (JS API)
            let darkMode = '未知';
            try {
                darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches ? '偏好暗色' : '偏好亮色';
            } catch (e) {
                console.log('获取暗色模式偏好失败:', e);
            }
            addInfoItem(systemInfoContainer, '暗色模式偏好', darkMode, INFO_SOURCE.JS_API);
            
            // 电池状态 (实验性，已淘汰)
            addAsyncInfoItem(systemInfoContainer, '电池状态', '获取中...', INFO_SOURCE.EXPERIMENTAL, async () => {
                try {
                    if (!navigator.getBattery) {
                        return '浏览器不支持';
                    }
                    
                    const battery = await navigator.getBattery();
                    const level = Math.round(battery.level * 100);
                    const status = battery.charging ? '充电中' : '放电中';
                    console.log("电池信息：", battery);
                    return `${level}% (${status})`;
                } catch (e) {
                    return '获取失败';
                }
            });
            
            // 充电时间 (实验性，已淘汰)
            addAsyncInfoItem(systemInfoContainer, '充满时间', '获取中...', INFO_SOURCE.EXPERIMENTAL, async () => {
                try {
                    if (!navigator.getBattery) {
                        return '浏览器不支持';
                    }
                    
                    const battery = await navigator.getBattery();
                    
                    // 格式化充电时间
                    const formattedTime = formatSecondsToTime(battery.chargingTime);
                    
                    return `${formattedTime}`;
                } catch (e) {
                    console.error("获取充电时间失败:", e);
                    return '获取失败';
                }
            });

            // 放电时间 (实验性，已淘汰)
            addAsyncInfoItem(systemInfoContainer, '耗尽时间', '获取中...', INFO_SOURCE.EXPERIMENTAL, async () => {
                try {
                    if (!navigator.getBattery) {
                        return '浏览器不支持';
                    }
                    
                    const battery = await navigator.getBattery();
                    
                    // 格式化放电时间
                    const formattedTime = formatSecondsToTime(battery.dischargingTime);
                    
                    return `${formattedTime}`;
                } catch (e) {
                    console.error("获取放电时间失败:", e);
                    return '获取失败';
                }
            });
            
            // 时区+语言+分辨率组合标识 (计算分析)
            try {
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown';
                const language = navigator.language || 'unknown';
                const resolution = `${screen.width}x${screen.height}`;
                const combined = `${timeZone}|${language}|${resolution}`;
                // 简单哈希计算
                const hash = simpleHash(combined);
                addInfoItem(systemInfoContainer, '组合标识哈希', hash, INFO_SOURCE.CALCULATED);
            } catch (e) {
                console.log('计算组合标识失败:', e);
                addInfoItem(systemInfoContainer, '组合标识哈希', '计算失败', INFO_SOURCE.CALCULATED);
            }
        }

        // 添加设备详细信息
        function addDeviceDetails() {
            const deviceInfoContainer = document.getElementById('deviceInfo');
            
            // CPU核心数 (JS API)
            let cpuCores = '未知';
            try {
                cpuCores = navigator.hardwareConcurrency ? navigator.hardwareConcurrency + ' 核心' : '未知';
            } catch (e) {
                console.log('获取CPU核心数失败:', e);
            }
            addInfoItem(deviceInfoContainer, 'CPU核心数', cpuCores, INFO_SOURCE.JS_API);
            
            // 内存容量 (JS API)
            let memory = '未知';
            try {
                memory = navigator.deviceMemory ? navigator.deviceMemory + ' GB' : '未知';
            } catch (e) {
                console.log('获取内存容量失败:', e);
            }
            addInfoItem(deviceInfoContainer, '内存容量', memory, INFO_SOURCE.JS_API);
            
            // 像素密度 (JS API)
            let pixelDensity = '未知';
            try {
                pixelDensity = window.devicePixelRatio ? window.devicePixelRatio.toFixed(2) + ' 像素/设备独立像素' : '未知';
            } catch (e) {
                console.log('获取像素密度失败:', e);
            }
            addInfoItem(deviceInfoContainer, '像素密度', pixelDensity, INFO_SOURCE.JS_API);
            
            // 屏幕分辨率 (JS API)
            let resolution = '未知';
            try {
                resolution = `${screen.width} x ${screen.height}`;
            } catch (e) {
                console.log('获取屏幕分辨率失败:', e);
            }
            addInfoItem(deviceInfoContainer, '屏幕分辨率', resolution, INFO_SOURCE.JS_API);
            
            // 色域支持 (JS API)
            let colorDepth = '未知';
            try {
                colorDepth = `${screen.colorDepth} 位`;
            } catch (e) {
                console.log('获取颜色深度失败:', e);
            }
            addInfoItem(deviceInfoContainer, '色域支持', colorDepth, INFO_SOURCE.JS_API);
        }

        // 添加网络信息
        function addNetworkDetails() {
            const networkInfoContainer = document.getElementById('networkInfo');
            
            // 网络类型 (计算分析)
            let networkType = '未知';
            try {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                console.log("网络类型：", connection);
                networkType = connection ? connection.effectiveType || '未知' : '不支持';
            } catch (e) {
                console.log('获取网络类型失败:', e);
            }
            addInfoItem(networkInfoContainer, '网络类型', networkType, INFO_SOURCE.CALCULATED);
            
            // 下行速度 (JS API)
            let downlink = '未知';
            try {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                downlink = connection && connection.downlink ? connection.downlink + ' Mbps' : '不支持';
            } catch (e) {
                console.log('获取下行速度失败:', e);
            }
            addInfoItem(networkInfoContainer, '下行速度', downlink, INFO_SOURCE.JS_API);
            
            // RTT延迟 (JS API)
            let rtt = '未知';
            try {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                rtt = connection && connection.rtt ? connection.rtt + ' ms' : '不支持';
            } catch (e) {
                console.log('获取RTT延迟失败:', e);
            }
            addInfoItem(networkInfoContainer, 'RTT延迟', rtt, INFO_SOURCE.JS_API);

            // 节省流量模式 (JS API)
            let saveData = '未知';
            try {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                saveData = connection && typeof connection.saveData === 'boolean' ? (connection.saveData ? '已启用' : '未启用') : '不支持';
            } catch (e) {
                console.log('获取节省流量模式失败:', e);
            }
            addInfoItem(networkInfoContainer, '节省流量模式', saveData, INFO_SOURCE.JS_API);
        }

        // 添加硬件与媒体信息
        function addHardwareDetails() {
            const hardwareInfoContainer = document.getElementById('hardwareInfo');
            
            // WebGL支持 (JS API)
            let webglSupport = '未知';
            try {
                webglSupport = !!document.createElement('canvas').getContext('webgl') ? '支持' : '不支持';
            } catch (e) {
                console.log('检测WebGL支持失败:', e);
                webglSupport = '检测失败';
            }
            addInfoItem(hardwareInfoContainer, 'WebGL支持', webglSupport, INFO_SOURCE.JS_API);
            
            // WebGL渲染指纹 (计算分析)
            addAsyncInfoItem(hardwareInfoContainer, 'WebGL渲染指纹', '获取中...', INFO_SOURCE.CALCULATED, async () => {
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    
                    if (!gl) return '不支持WebGL';
                    
                    // 1. 收集基础特征
                    const features = {
                        vendor: gl.getParameter(gl.VENDOR),
                        renderer: gl.getParameter(gl.RENDERER),
                        maxTextureSize: gl.getParameter(gl.MAX_TEXTURE_SIZE),
                        shadingLanguage: gl.getParameter(gl.SHADING_LANGUAGE_VERSION),
                        extensions: gl.getSupportedExtensions()
                    };
                    
                    // 2. 获取像素数据（简化版）
                    const pixelData = await getSimplifiedPixelData(gl);
                    
                    // 3. 组合特征数据
                    const dataString = JSON.stringify(features) + pixelData;
                    
                    // 4. 使用简单哈希函数生成指纹
                    const hash = simpleHash(dataString);
                    
                    return hash;
                } catch (e) {
                    console.error("WebGL指纹生成失败:", e);
                    return '计算失败';
                }
            });

            // 简化的像素数据获取函数
            function getSimplifiedPixelData(gl) {
                return new Promise((resolve) => {
                    try {
                        // 创建小尺寸Canvas (16x16)
                        const canvas = document.createElement('canvas');
                        canvas.width = 16;
                        canvas.height = 16;
                        const smallGl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                        
                        if (!smallGl) {
                            resolve(''); // 无法获取像素数据
                            return;
                        }
                        
                        // 创建帧缓冲区
                        const framebuffer = smallGl.createFramebuffer();
                        smallGl.bindFramebuffer(smallGl.FRAMEBUFFER, framebuffer);
                        
                        // 创建纹理
                        const texture = smallGl.createTexture();
                        smallGl.bindTexture(smallGl.TEXTURE_2D, texture);
                        smallGl.texImage2D(smallGl.TEXTURE_2D, 0, smallGl.RGBA, 16, 16, 0, 
                                          smallGl.RGBA, smallGl.UNSIGNED_BYTE, null);
                        smallGl.framebufferTexture2D(smallGl.FRAMEBUFFER, smallGl.COLOR_ATTACHMENT0, 
                                                   smallGl.TEXTURE_2D, texture, 0);
                        
                        // 绘制简单图形
                        const vertexShader = smallGl.createShader(smallGl.VERTEX_SHADER);
                        smallGl.shaderSource(vertexShader, `
                            attribute vec2 position;
                            void main() {
                                gl_Position = vec4(position, 0, 1);
                            }
                        `);
                        smallGl.compileShader(vertexShader);
                        
                        const fragmentShader = smallGl.createShader(smallGl.FRAGMENT_SHADER);
                        smallGl.shaderSource(fragmentShader, `
                            precision mediump float;
                            void main() {
                                gl_FragColor = vec4(gl_FragCoord.x/16.0, gl_FragCoord.y/16.0, 0.5, 1.0);
                            }
                        `);
                        smallGl.compileShader(fragmentShader);
                        
                        const program = smallGl.createProgram();
                        smallGl.attachShader(program, vertexShader);
                        smallGl.attachShader(program, fragmentShader);
                        smallGl.linkProgram(program);
                        smallGl.useProgram(program);
                        
                        // 设置顶点数据
                        const buffer = smallGl.createBuffer();
                        smallGl.bindBuffer(smallGl.ARRAY_BUFFER, buffer);
                        smallGl.bufferData(smallGl.ARRAY_BUFFER, new Float32Array([
                            -1, -1, 1, -1, -1, 1
                        ]), smallGl.STATIC_DRAW);
                        
                        const positionLoc = smallGl.getAttribLocation(program, 'position');
                        smallGl.enableVertexAttribArray(positionLoc);
                        smallGl.vertexAttribPointer(positionLoc, 2, smallGl.FLOAT, false, 0, 0);
                        
                        // 绘制
                        smallGl.drawArrays(smallGl.TRIANGLES, 0, 3);
                        
                        // 读取像素数据
                        const pixels = new Uint8Array(16 * 16 * 4);
                        smallGl.readPixels(0, 0, 16, 16, smallGl.RGBA, smallGl.UNSIGNED_BYTE, pixels);
                        
                        // 转换为简化的字符串表示
                        let pixelString = '';
                        for (let i = 0; i < pixels.length; i += 4) {
                            // 只取RGB值，忽略Alpha
                            pixelString += pixels[i].toString(16).padStart(2, '0');
                            pixelString += pixels[i+1].toString(16).padStart(2, '0');
                            pixelString += pixels[i+2].toString(16).padStart(2, '0');
                        }
                        
                        resolve(pixelString);
                    } catch (e) {
                        console.error("简化像素数据获取失败:", e);
                        resolve('');
                    }
                });
            };
            
            // 媒体设备ID哈希值 (需授权)
            addAsyncInfoItem(hardwareInfoContainer, '媒体设备ID哈希', '点击获取', INFO_SOURCE.AUTHORIZATION, async () => {
                try {
                    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                        return '浏览器不支持';
                    }
                    
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    console.log("媒体设备：", devices);
                    let deviceIds = [];
                    
                    devices.forEach(device => {
                        if (device.deviceId && device.kind) {
                            deviceIds.push(`${device.kind}:${device.deviceId}`);
                        }
                    });
                    
                    if (deviceIds.length === 0) {
                        return '未检测到媒体设备ID';
                    }
                    
                    return simpleHash(deviceIds.join('|'));
                } catch (e) {
                    return e.name === 'NotAllowedError' ? '需要用户授权' : '获取失败';
                }
            });
            
            // 麦克风信息 (需授权)
            addAsyncInfoItem(hardwareInfoContainer, '麦克风', '点击获取', INFO_SOURCE.AUTHORIZATION, async () => {
                try {
                    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                        return '浏览器不支持';
                    }
                    
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    let mics = [];
                    
                    devices.forEach(device => {
                        if (device.kind === 'audioinput') {
                            mics.push(device.label || '未知麦克风');
                        }
                    });
                    
                    return mics.length > 0 ? mics.join('; ') : '未检测到麦克风';
                } catch (e) {
                    return e.name === 'NotAllowedError' ? '需要用户授权' : '获取失败';
                }
            });
            
            // 摄像头信息 (需授权)
            addAsyncInfoItem(hardwareInfoContainer, '摄像头', '点击获取', INFO_SOURCE.AUTHORIZATION, async () => {
                try {
                    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {
                        return '浏览器不支持';
                    }
                    
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    let cameras = [];
                    
                    devices.forEach(device => {
                        if (device.kind === 'videoinput') {
                            cameras.push(device.label || '未知摄像头');
                        }
                    });
                    
                    return cameras.length > 0 ? cameras.join('; ') : '未检测到摄像头';
                } catch (e) {
                    return e.name === 'NotAllowedError' ? '需要用户授权' : '获取失败';
                }
            });
            
            // 蓝牙设备 (需授权)
            addAsyncInfoItem(hardwareInfoContainer, '蓝牙设备', '点击获取', INFO_SOURCE.AUTHORIZATION, async () => {
                try {
                    if (!navigator.bluetooth) {
                        return '浏览器不支持';
                    }
                    
                    const device = await navigator.bluetooth.requestDevice({
                        acceptAllDevices: true
                    });
                    console.log("蓝牙设备：", device);
                    
                    return `已找到: ${device.name || '未知设备'}`;
                } catch (e) {
                    return e.name === 'NotAllowedError' ? '需要用户授权' : 
                           e.name === 'AbortError' ? '用户取消选择' : '获取失败';
                }
            });
            
            // 外设设备 (需授权)
            addAsyncInfoItem(hardwareInfoContainer, 'HID外设设备', '点击获取', INFO_SOURCE.EXPERIMENTAL, async () => {
                try {
                    if (!navigator.hid) {
                        return '浏览器不支持';
                    }
                    
                    const devices = await navigator.hid.getDevices();
                    console.log("外设设备：", devices);
                    return devices.length > 0 ? 
                        `已检测到 ${devices.length} 个设备` : 
                        '未检测到HID设备';
                } catch (e) {
                    return e.name === 'NotAllowedError' ? '需要用户授权' : '获取失败';
                }
            });
            
            // 指纹/面部识别 (实验性)
            addAsyncInfoItem(hardwareInfoContainer, '生物识别支持', '点击检测', INFO_SOURCE.EXPERIMENTAL, async () => {
                try {
                    if (!PublicKeyCredential) {
                        return '浏览器不支持WebAuthn';
                    }
                    
                    // 简单检测是否支持生物识别
                    const isAvailable = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
                    return isAvailable ? '支持生物识别' : '不支持生物识别';
                } catch (e) {
                    return '检测失败';
                }
            });
        }

        // 加载异步信息
        function loadAsyncInformation() {
            // 触发所有需要异步加载的信息
            document.querySelectorAll('.async-info-trigger').forEach(trigger => {
                trigger.addEventListener('click', async function() {
                    const infoItem = this.closest('.info-item');
                    const valueElement = infoItem.querySelector('.info-value');
                    const originalText = valueElement.textContent;
                    valueElement.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 加载中...';
                    
                    try {
                        const getData = this.getDataFunction;
                        const result = await getData();
                        valueElement.textContent = result;
                    } catch (e) {
                        valueElement.textContent = '获取失败';
                    }
                });
            });
        }

        // 添加信息项
        function addInfoItem(container, label, value, sourceType, asyncFunction) {
            const item = document.createElement('div');
            item.className = 'flex items-center info-item';
            
            // 根据信息来源设置不同颜色的标记
            let markerColor = 'bg-gray-400'; // 默认灰色
            switch(sourceType) {
                case INFO_SOURCE.UA_PARSE:
                    markerColor = 'bg-blue-500';
                    break;
                case INFO_SOURCE.JS_API:
                    markerColor = 'bg-green-500';
                    break;
                case INFO_SOURCE.CALCULATED:
                    markerColor = 'bg-purple-500';
                    break;
                case INFO_SOURCE.AUTHORIZATION:
                    markerColor = 'bg-orange-500';
                    break;
                case INFO_SOURCE.EXPERIMENTAL:
                    markerColor = 'bg-gray-400';
                    break;
            }
            
            // 如果是异步获取的信息，添加点击触发功能
            let valueHtml = '';
            if (asyncFunction) {
                valueHtml = `
                    <span class="text-sm text-gray-800 font-mono info-value">${value}</span>
                    <button class="async-info-trigger ml-2 text-primary text-xs p-1" title="点击获取信息">
                        <i class="fa fa-refresh"></i>
                    </button>
                `;
            } else {
                valueHtml = `<span class="text-sm text-gray-800 font-mono info-value">${value}</span>`;
            }
            
            item.innerHTML = `
                <span class="inline-block w-3 h-3 rounded-full ${markerColor} mr-2" title="${getSourceName(sourceType)}"></span>
                <span class="text-sm font-medium text-gray-500 w-1/3">${label}：</span>
                ${valueHtml}
            `;
            
            // 如果有异步函数，绑定到按钮
            if (asyncFunction) {
                const trigger = item.querySelector('.async-info-trigger');
                trigger.getDataFunction = asyncFunction;
            }
            
            container.appendChild(item);
        }

        // 添加需要异步获取的信息项
        function addAsyncInfoItem(container, label, initialText, sourceType, asyncFunction) {
            addInfoItem(container, label, initialText, sourceType, asyncFunction);
        }

        // 获取信息来源名称
        function getSourceName(sourceType) {
            switch(sourceType) {
                case INFO_SOURCE.UA_PARSE:
                    return 'UA解析';
                case INFO_SOURCE.JS_API:
                    return 'JS API';
                case INFO_SOURCE.CALCULATED:
                    return '计算分析';
                case INFO_SOURCE.AUTHORIZATION:
                    return '需授权';
                case INFO_SOURCE.EXPERIMENTAL:
                    return '实验性';
                default:
                    return '未知来源';
            }
        }

        // 切换原始头信息显示
        function toggleRawHeaders() {
            const container = document.getElementById('rawHeadersContainer');
            const btnText = document.getElementById('toggleHeadersText');
            const btnIcon = document.getElementById('toggleHeadersIcon');

            const isHidden = container.classList.contains('hidden');

            if (isHidden) {
                container.classList.remove('hidden');
                btnText.textContent = '隐藏详情';
                btnIcon.className = 'fa fa-chevron-up ml-1 text-xs';
            } else {
                container.classList.add('hidden');
                btnText.textContent = '显示详情';
                btnIcon.className = 'fa fa-chevron-down ml-1 text-xs';
            }
        }

        // 获取地理位置信息
        function getGeolocation() {
            const statusElement = document.getElementById('locationStatus');
            const detailsElement = document.getElementById('locationDetails');
            const button = document.getElementById('getLocationBtn');
            
            // 禁用按钮，显示加载状态
            button.disabled = true;
            statusElement.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 正在获取位置信息...';
            detailsElement.classList.add('hidden');
            detailsElement.innerHTML = '';
            
            if (!navigator.geolocation) {
                statusElement.innerHTML = '<i class="fa fa-exclamation-circle text-danger"></i> 您的浏览器不支持地理位置服务';
                button.disabled = false;
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // 成功获取位置信息
                    statusElement.innerHTML = '<i class="fa fa-check text-secondary"></i> 位置信息获取成功';
                    button.disabled = false;
                    
                    const lat = position.coords.latitude.toFixed(6);
                    const lng = position.coords.longitude.toFixed(6);
                    
                    // 显示位置详情，包含地图选择下拉框
                    detailsElement.innerHTML = `
                        <div class="mb-2">
                            <span class="text-sm font-medium text-gray-500">纬度：</span>
                            <span class="text-sm text-gray-800 font-mono">${lat}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-sm font-medium text-gray-500">经度：</span>
                            <span class="text-sm text-gray-800 font-mono">${lng}</span>
                        </div>
                        <div class="mb-2">
                            <span class="text-sm font-medium text-gray-500">精度：</span>
                            <span class="text-sm text-gray-800 font-mono">约 ${Math.round(position.coords.accuracy)} 米</span>
                        </div>
                        <div class="flex items-center mt-2">
                            <span class="text-sm font-medium text-gray-500 mr-2">在地图上查看：</span>
                            <select id="mapSelector" class="text-sm border rounded px-2 py-1 mr-2">
                                <option value="amap">高德地图</option>
                                <option value="baidu">百度地图</option>
                                <option value="tencent">腾讯地图</option>
                                <option value="google">Google Map</option>
                            </select>
                            <button onclick="openMap('${lat}', '${lng}')" 
                                    class="text-primary text-sm inline-flex items-center btn-hover">
                                <i class="fa fa-map mr-1"></i> 查看
                            </button>
                        </div>
                    `;
                    detailsElement.classList.remove('hidden');
                },
                (error) => {
                    // 处理错误
                    let errorMessage = '';
                    switch(error.code) {
                        case 1:
                            errorMessage = '您拒绝了位置信息请求，请在浏览器设置中允许';
                            break;
                        case 2:
                            errorMessage = '无法获取位置信息，请稍后重试';
                            break;
                        case 3:
                            errorMessage = '获取位置信息超时';
                            break;
                        default:
                            errorMessage = '发生未知错误';
                    }
                    
                    statusElement.innerHTML = `<i class="fa fa-exclamation-circle text-danger"></i> ${errorMessage}`;
                    button.disabled = false;
                },
                {
                    maximumAge: 0, // 不使用缓存位置
                    timeout: 15000, // 15秒超时
                    enableHighAccuracy: false // 不要求高精度
                }
            );
        }

        // 打开选择的地图
        function openMap(lat, lng) {
            const mapType = document.getElementById('mapSelector').value;
            let url = '';
            
            switch(mapType) {
                case 'amap': // 高德地图
                    url = `https://uri.amap.com/marker?position=${lng},${lat}&name=当前位置&coordinate=wgs84`;
                    break;
                case 'baidu': // 百度地图
                    url = `https://api.map.baidu.com/marker?location=${lat},${lng}&title=当前位置&content=通过浏览器获取的位置&output=html&src=webapp.baidu.openAPIdemo`;
                    break;
                case 'tencent': // 腾讯地图
                    url = `https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=${lng}&pointy=${lat}&name=当前位置`;
                    break;
                case 'google': // Google Map
                    url = `https://maps.google.com/maps?q=${lat},${lng}`;
                    break;
            }
            
            if (url) {
                window.open(url, '_blank', 'noopener noreferrer');
            }
        }


        // =============================
        // 各业务通用 获取和处理数据等 核心底层函数
        // =============================


        // 我的IP：统一的查询函数，支持主IP和副IP字段
        function unifiedCheck(configId) {
            const config = checkConfigs.find(c => c.id === configId);
            if (!config) return;


            const ids = getElementIds(configId);


            // 设置加载状态
            ids.loadingIds.forEach(id => setLoading(id));


            fetch(config.url)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return config.responseType === 'json' ? response.json() : response.text();
                })
                .then(data => {
                    // 处理文本响应
                    let responseData = data;


                    // 格式预处理
                    if (config.responseType === 'jsonp') {
                        // 处理JSONP格式
                        let jsonString = data;
                        // 检查是否是JSONP格式（函数调用包裹的JSON）
                        const jsonpMatch = extractJsonpContent(data);
                        if (jsonpMatch) {
                            jsonString = jsonpMatch;
                        }
                        try {
                            responseData = JSON.parse(jsonString);
                        } catch (e) {
                            console.error(`无法解析文本响应为JSON: ${e.message}`);
                            responseData = null;
                        }
                    } else if (config.responseType === 'json') {
                        if (typeof data === 'string') {
                            // 处理Json内容的字符串
                            try {
                                responseData = JSON.parse(data);
                            } catch (e) {
                                console.error(`无法解析文本响应为JSON: ${e.message}`);
                                responseData = null;
                            }
                        }
                    }

                    // 处理data字段配置
                    if (config.data && config.data.trim() !== '') {
                        // 如果配置了data字段，尝试从响应中提取该字段
                        if (typeof responseData === 'object' && responseData !== null && responseData[config.data]) {
                            responseData = responseData[config.data];
                        } else {
                            console.error(`配置的data字段"${config.data}"在响应中不存在或无效`);
                        }
                    }


                    // 提取主IP地址
                    let primaryIp;
                    if (config.ipField && config.ipField.trim() !== '' && typeof responseData === 'object' && responseData !== null) {
                        primaryIp = getNestedValue(responseData, config.ipField);
                    } else if (config.responseType === 'text') {
                        // 对于文本响应，直接使用文本值
                        primaryIp = typeof responseData === 'string' ? responseData.trim() : '';
                    }


                    // 提取副IP地址（如果配置）
                    let secondaryIp = null;
                    if (config.ipFieldSecondary && config.ipFieldSecondary.trim() !== '' && typeof responseData === 'object' && responseData !== null) {
                        secondaryIp = getNestedValue(responseData, config.ipFieldSecondary);
                    }


                    // 处理IP显示逻辑
                    // 先重置显示状态
                    setNoData(ids.resultElements.ipv4, '无IPv4地址');
                    setNoData(ids.resultElements.ipv6, '无IPv6地址');


                    // 处理主IP
                    if (primaryIp) {
                        if (isIPv4(primaryIp)) {
                            setResult(ids.resultElements.ipv4, primaryIp);
                        } else if(isIPv6(primaryIp)) {
                            setResult(ids.resultElements.ipv6, primaryIp);
                        }
                    }


                    // 处理副IP（如果存在）
                    if (secondaryIp && secondaryIp !== primaryIp) {
                        if (isIPv4(secondaryIp)) {
                            setResult(ids.resultElements.ipv4, secondaryIp);
                        } else if(isIPv6(secondaryIp)) {
                            setResult(ids.resultElements.ipv6, secondaryIp);
                        }
                    }


                    // 处理详情表格
                    const detailsData = config.responseType === 'json' ? responseData : {};
                    populateDetailsTable(ids.detailsTableId, detailsData, config.excludeFields);


                    showNotification(`${config.name} 刷新成功`);
                })
                .catch(err => {
                    console.error(`${config.name} 查询失败:`, err);
                    // 错误分类处理
                    let errorType = 'UNKNOWN';
                    let errorMsg = '服务不可用';


                    if (err instanceof TypeError) {
                        // 网络级错误（DNS解析失败、CORS、连接超时等）
                        errorType = 'NETWORK';
                        errorMsg = '网络错误，网站不可达';
                    } else if (err.status) {
                        // HTTP状态码错误
                        errorType = 'HTTP_' + err.status;
                        errorMsg = `服务异常 (${err.status})`;
                    }


                    // 设置错误状态 - 区分全局错误和详细错误
                    setError(ids.loadingIds[0], `获取失败`); // 全局简短错误
                    setError(ids.loadingIds[1], `${errorMsg}`, errorType); // 详细错误信息


                    populateDetailsTable(ids.detailsTableId, {}, config.excludeFields);
                    showNotification(`${config.name} 刷新失败`, false);
                });
        }


        // 控制复制按钮显示/隐藏
        function toggleCopyButton(ipElementId, copyButtonId) {
            const ipElement = document.getElementById(ipElementId);
            const copyButton = document.getElementById(copyButtonId);
            if (!ipElement || !copyButton) return;


            const ipText = ipElement.textContent;


            // 正常IP地址显示复制按钮，其他状态隐藏
            if (ipText && ipText !== '加载中...' && ipText !== '获取失败' && ipText !== '-' && !ipText.includes('无数据') && !ipText.includes('无IPv4') && !ipText.includes('无IPv6')) {
                copyButton.classList.remove('hidden');
            } else {
                copyButton.classList.add('hidden');
            }
        }


        // 工具函数：设置加载状态
        function setLoading(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;


            element.textContent = '加载中...';
            element.className = element.className.replace('text-danger', '').replace('text-gray-400', '');
            element.classList.add('text-neutral', 'pulse');


            // 更新对应复制按钮状态
            const copyButtonId = 'copy' + capitalizeFirstLetter(elementId);
            if (document.getElementById(copyButtonId)) {
                toggleCopyButton(elementId, copyButtonId);
            }
        }


        // 工具函数：设置结果
        function setResult(elementId, value) {
            const element = document.getElementById(elementId);
            if (!element) return;


            element.textContent = value;
            element.className = element.className.replace('text-danger', '').replace('text-neutral', '').replace('text-gray-400', '').replace('pulse', '');
            element.classList.add('text-gray-800');


            // 更新对应复制按钮状态
            const copyButtonId = 'copy' + capitalizeFirstLetter(elementId);
            if (document.getElementById(copyButtonId)) {
                toggleCopyButton(elementId, copyButtonId);
            }
        }


        // 工具函数：设置错误信息
        function setError(elementId, message, errorType = '') {
            const element = document.getElementById(elementId);
            if (!element) return;


            element.textContent = message;
            element.className = element.className.replace('text-danger', '').replace('text-neutral', '').replace('pulse', '');
            element.classList.add('text-gray-400');


            // 根据错误类型添加额外样式（可选）
            if (errorType.startsWith('HTTP_5')) {
                element.classList.add('font-italic');  // 服务器错误添加斜体
            }


            // 更新对应复制按钮状态
            const copyButtonId = 'copy' + capitalizeFirstLetter(elementId);
            if (document.getElementById(copyButtonId)) {
                toggleCopyButton(elementId, copyButtonId);
            }
        }


        // 工具函数：设置无数据信息
        function setNoData(elementId, message = '无数据') {
            const element = document.getElementById(elementId);
            if (!element) return;


            element.textContent = message;
            element.className = element.className.replace('text-danger', '').replace('text-neutral', '').replace('pulse', '');
            element.classList.add('text-gray-400');


            // 更新对应复制按钮状态
            const copyButtonId = 'copy' + capitalizeFirstLetter(elementId);
            if (document.getElementById(copyButtonId)) {
                toggleCopyButton(elementId, copyButtonId);
            }
        }


        // 工具函数：填充详细信息表格
        function populateDetailsTable(tableId, data, excludeKeys = []) {
            const tableBody = document.getElementById(tableId);
            if (!tableBody) return;


            // 找到对应的配置项
            const config = checkConfigs.find(c => getElementIds(c.id).detailsTableId === tableId);
            if (!config) return;


            const detailsBtn = document.getElementById(getElementIds(config.id).detailsBtnId);


            tableBody.innerHTML = ''; // 清空现有内容


            // 过滤掉空值和需要排除的键
            const filteredData = {};
            if (data && typeof data === 'object') {
                for (const [key, value] of Object.entries(data)) {
                    if (!excludeKeys.includes(key) && value !== null && value !== undefined && value !== '') {
                        filteredData[key] = value;
                    }
                }
            }


            // 如果没有数据，显示提示并禁用按钮
            if (Object.keys(filteredData).length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="2" class="px-4 py-3 text-sm text-gray-500">
                        无详细信息
                    </td>
                `;
                tableBody.appendChild(row);


                // 禁用详情按钮
                if (detailsBtn) {
                    detailsBtn.disabled = true;
                    detailsBtn.classList.remove('text-primary', 'btn-hover');
                    detailsBtn.classList.add('text-gray-400', 'cursor-not-allowed');
                }
            } else {
                // 启用详情按钮
                if (detailsBtn) {
                    detailsBtn.disabled = false;
                    detailsBtn.classList.remove('text-gray-400', 'cursor-not-allowed');
                    detailsBtn.classList.add('text-primary', 'btn-hover');
                }


                // 填充数据
                for (const [key, value] of Object.entries(filteredData)) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm font-medium text-gray-500">${formatKey(key)}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 font-mono">${formatValue(value)}</td>
                    `;
                    tableBody.appendChild(row);
                }
            }
        }


        // IP/域名/MAC地址信息查询通用：创建查询部分
        function createQuerySection(parent, detailsContainer, targetValue, apiId, type, title, url, postParams, responseType, dataField, selectors, excludeFields) {
            const sectionId = `section_${apiId}_${type}`;
            const detailsId = `details_${apiId}_${type}`;

            const section = document.createElement('div');
            section.className = 'query-section cursor-pointer rounded p-2 border border-gray-200 flex justify-between items-center';
            section.innerHTML = `
                
                <div class="flex items-center">
                    <i class="fa fa-angle-right text-neutral mr-2" id="${sectionId}_icon"></i>
                    <span class="font-medium text-gray-700">${title}</span>
                </div>
                <div class="text-xs text-gray-500" id="${sectionId}_status">
                    <i class="fa fa-spinner fa-spin"></i> 加载中...
                </div>
            `;

            // 添加点击事件，确保点击一个类别时先收起其他已展开的类别
            section.addEventListener('click', function() {
                // 收起当前API下所有已展开的详情
                const allDetails = detailsContainer.querySelectorAll('[id^="details_"]');
                allDetails.forEach(detail => {
                    if (detail.id !== detailsId) {
                        detail.classList.add('hidden');
                        const iconId = detail.id.replace('details_', 'section_') + '_icon';
                        const icon = document.getElementById(iconId);
                        if (icon) {
                            icon.className = 'fa fa-angle-right text-neutral mr-2';
                        }
                    }
                });

                // 切换当前详情的显示状态
                const details = document.getElementById(detailsId);
                const icon = document.getElementById(`${sectionId}_icon`);

                if (details.classList.contains('hidden')) {
                    details.classList.remove('hidden');
                    icon.className = 'fa fa-angle-down text-neutral mr-2';
                } else {
                    details.classList.add('hidden');
                    icon.className = 'fa fa-angle-right text-neutral mr-2';
                }
            });

            parent.appendChild(section);

            // 创建详情容器
            const details = document.createElement('div');
            details.id = detailsId;
            details.className = 'hidden p-4 bg-gray-50 rounded-lg border border-gray-200 text-sm fade-in';
            detailsContainer.appendChild(details);

            // 发起请求
            fetchData(targetValue, url, postParams, responseType, dataField, selectors, excludeFields, detailsId, sectionId + "_status");
        }


        // IP/域名/MAC地址信息查询通用：获取信息数据并显示
        function fetchData(targetValue, url, postParams, responseType, dataField, selectors, excludeFields, detailsId, statusId) {
            // 获取状态元素
            const statusElement = document.getElementById(statusId);

            // 设置加载状态
            setFetchLoading(statusElement);

            // 配置请求选项
            const fetchOptions = { method: 'GET' };

            // 根据postParams处理请求方式和参数
            if (postParams !== null) {
                // 判断是否为JSON对象（排除数组和null）
                if (typeof postParams === 'object' &&
                    postParams !== null &&
                    Object.prototype.toString.call(postParams) === '[object Object]') {
                    // 发送application/json形式的POST请求
                    fetchOptions.method = 'POST';
                    fetchOptions.headers = {
                        'Content-Type': 'application/json'
                    };
                    // 替换MAC地址占位符
                    let bodyStr = JSON.stringify(postParams);
                    bodyStr = bodyStr.replace('$mac', targetValue);
                    bodyStr = bodyStr.replace('$ip', targetValue);
                    fetchOptions.body = bodyStr;
                }
                // 判断是否为字符串
                else if (typeof postParams === 'string') {
                    // 发送application/x-www-form-urlencoded形式的POST请求
                    fetchOptions.method = 'POST';
                    fetchOptions.headers = {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    };
                    // 替换MAC地址占位符
                    let bodyStr = postParams;
                    bodyStr = bodyStr.replace('$mac', targetValue);
                    bodyStr = bodyStr.replace('$ip', targetValue);
                    fetchOptions.body = bodyStr;
                }
            }

            fetch(url, fetchOptions)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    switch(responseType) {
                        case 'json':
                            return response.json();
                        case 'jsonp':
                            return response.text().then(text => {
                                const jsonpMatch = extractJsonpContent(text);
                                if (jsonpMatch) {
                                    return JSON.parse(jsonpMatch);
                                }
                                throw new Error('无法解析JSONP响应');
                            });
                        case 'html': // 新增html类型
                            return response.text();
                        default: // text
                            return response.text();
                    }
                })
                .then(data => {
                    // 处理dataField - 如果指定了data字段，提取该字段的值
                    let processedData = data;
                    if (dataField && dataField.trim() !== '' && typeof data === 'object' && data !== null) {
                        const extractedValue = getNestedValue(data, dataField);
                        if (extractedValue !== null) {
                            processedData = extractedValue;
                        } else {
                            console.warn(`指定的data字段"${dataField}"在响应中不存在或无效`);
                        }
                    }

                    // 更新状态
                    setFetchSuccess(statusElement);
                    
                    const detailsElement = document.getElementById(detailsId);

                    if (processedData === null || processedData === '') {
                        // 设置无数据状态
                        setFetchNoData(statusElement, detailsElement);
                        return;
                    }

                    // 处理HTML类型响应
                    if (responseType === 'html') {
                        // 检查选择器是否为空
                        if (!selectors || selectors.length === 0) {
                            setFetchNoData(statusElement, detailsElement);
                            return;
                        }
                        
                        // 创建临时DOM容器解析HTML
                        const parser = new DOMParser();
                        const htmlDoc = parser.parseFromString(processedData, 'text/html');
                        
                        // 存储提取结果
                        const extractedData = {};
                        let hasValidData = false;
                        
                        // 遍历所有选择器
                        for (let i = 0; i < selectors.length; i++) {
                            const selector = selectors[i];
                            
                            // 跳过空选择器
                            if (!selector || selector.trim() === '') continue;
                            
                            // 查找匹配元素
                            const element = htmlDoc.querySelector(selector);
                            if (!element) continue;
                            
                            // 获取文本内容（优先使用innerText）
                            let text = element.innerText || element.textContent || '';
                            text = text.trim();
                            
                            // 跳过空文本
                            if (!text) continue;
                            
                            // 存储结果（使用索引作为key）
                            extractedData[i] = text;
                            hasValidData = true;
                        }
                        
                        // 检查是否有有效数据
                        if (!hasValidData) {
                            setFetchNoData(statusElement, detailsElement);
                            return;
                        }
                        
                        // 构建结果列表
                        let html = '<ul class="space-y-2">';
                        for (const [key, value] of Object.entries(extractedData)) {
                            html += `
                                <li class="p-2 bg-white rounded border border-gray-200">
                                    <span class="font-medium text-gray-600">${key}:</span>
                                    <span class="ml-2 text-gray-800 font-mono">${value}</span>
                                </li>
                            `;
                        }
                        html += '</ul>';
                        
                        detailsElement.innerHTML = html;
                    } else if (responseType === 'text') {
                        // 处理文本类型响应：文本类型直接显示
                        detailsElement.innerHTML = `
                            <pre class="whitespace-pre-wrap font-mono text-gray-800 overflow-x-auto p-2 bg-white rounded border border-gray-200">${processedData.trim()}</pre>
                        `;
                    } else {
                        // 处理JSON类型响应：JSON或JSONP类型，以列表形式展示
                        if (typeof processedData !== 'object') {
                            detailsElement.innerHTML = `
                                <div class="text-gray-700 p-2 bg-white rounded border border-gray-200">
                                    ${formatValue(processedData)}
                                </div>
                            `;
                            return;
                        }

                        // 过滤需要排除的字段
                        const filteredData = {};
                        for (const [key, value] of Object.entries(processedData)) {
                            if (!excludeFields.includes(key)) {
                                filteredData[key] = value;
                            }
                        }

                        if (Object.keys(filteredData).length === 0) {
                            // 设置无数据状态
                            setFetchNoData(statusElement, detailsElement);
                        } else {
                           // 构建列表
                            let html = '<ul class="space-y-2">';
                            for (const [key, value] of Object.entries(filteredData)) {
                                html += `
                                    <li class="p-2 bg-white rounded border border-gray-200">
                                        <span class="font-medium text-gray-600">${formatKey(key)}:</span>
                                        <span class="ml-2 text-gray-800 font-mono">${formatValue(value)}</span>
                                    </li>
                                `;
                            }
                            html += '</ul>';

                            detailsElement.innerHTML = html; 
                        }
                    }
                })
                .catch(err => {
                    console.error('数据请求失败:', err);
                    const detailsElement = document.getElementById(detailsId);
                    setFetchError(statusElement, detailsElement);
                });
        }


        function setFetchLoading(statusElement) {
            if (statusElement) {
                statusElement.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 加载中...';
            }
        }

        function setFetchSuccess(statusElement) {
            if (statusElement) {
                statusElement.innerHTML = '<i class="fa fa-check text-secondary"></i> 加载完成';
            }
        }

        function setFetchNoData(statusElement, detailsElement) {
            if (statusElement) {
                statusElement.innerHTML = '<i class="fa fa-times text-danger"></i> 无数据';
            }
            if (detailsElement) {
                detailsElement.innerHTML = `
                    <div class="text-gray-500 p-3 bg-gray-100 rounded border border-gray-200">
                        获取数据为空，可能是不支持当前查询
                    </div>
                `;
            }
        }

        function setFetchError(statusElement, detailsElement) {
            if (statusElement) {
                statusElement.innerHTML = '<i class="fa fa-times text-danger"></i> 加载失败';
            }
            if (detailsElement) {
                detailsElement.innerHTML = `
                    <div class="text-gray-500 p-3 bg-gray-100 rounded border border-gray-200">
                        无法获取数据，可能是服务暂时不可用
                    </div>
                `;
            }
        }


        // =============================
        // 通用工具函数
        // =============================


        // 将秒数转换为 "x小时x分钟x秒" 格式
        function formatSecondsToTime(seconds) {
            // 处理特殊值
            if (seconds === Infinity) return "未知";
            if (seconds === 0) return "很快";
            
            // 计算各时间单位
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            // 构建结果字符串
            const parts = [];
            if (hours > 0) parts.push(`${hours}小时`);
            if (minutes > 0) parts.push(`${minutes}分钟`);
            if (secs > 0 || parts.length === 0) parts.push(`${secs}秒`);
            
            return parts.join("");
        }

        // 简单哈希函数
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // 转换为32位整数
            }
            // 转换为16进制字符串
            return Math.abs(hash).toString(16).substring(0, 10);
        }

        // 判断输入类型：仅返回类型标识符（ipv4/ipv6/domain）
        function determineInputType(input) {
            if (isIPv4(input)) {
                return 'ipv4';
            }

            if (isIPv6(input)) {
                return 'ipv6';
            }

            return 'domain';
        }

        // 验证MAC地址格式
        function isValidMacAddress(mac) {
            // 支持多种格式：
            // 1. 冒号分隔: AA:BB:CC:DD:EE:FF
            // 2. 连字符分隔: AA-BB-CC-DD-EE-FF
            // 3. 空格分隔: AA BB CC DD EE FF
            // 4. 点分隔: AABB.CCDD.EEFF
            // 5. 无分隔符: AABBCCDDEEFF
            const macRegex = /^([0-9A-Fa-f]{2}[:\- ]){5}([0-9A-Fa-f]{2})$|^([0-9A-Fa-f]{4}\.){2}([0-9A-Fa-f]{4})$|^[0-9A-Fa-f]{12}$/;
            return macRegex.test(mac);
        }

        // 标准化MAC地址格式（统一为冒号分隔）
        function normalizeMacAddress(mac) {
            // 移除所有分隔符
            let cleaned = mac.replace(/[:\- .]/g, '').toUpperCase();
            
            // 按每两个字符一组添加冒号
            let normalized = [];
            for (let i = 0; i < cleaned.length; i += 2) {
                normalized.push(cleaned.substr(i, 2));
            }
            
            return normalized.join(':');
        }
    

        // 处理域名格式化
        function normalizeDomain(domain) {
            let normalized = domain;
            // 去除http/https头
            normalized = normalized.replace(/^https?:\/\//, '');

            // 去除路径部分
            const pathIndex = normalized.indexOf('/');
            if (pathIndex !== -1) {
                normalized = normalized.substring(0, pathIndex);
            }

            // 去除端口号
            const portIndex = normalized.indexOf(':');
            if (portIndex !== -1) {
                normalized = normalized.substring(0, portIndex);
            }

            return normalized;
        }

        // 判断是否为IPv4地址的函数
        function isIPv4(ip) {
            if (!ip) return false;
            // IPv4地址正则表达式：四组0-255的数字，用点分隔
            const ipv4Regex = /^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;
            if (!ipv4Regex.test(ip)) return false;


            // 检查每组数字是否在0-255范围内
            const parts = ip.split('.');
            return parts.every(part => parseInt(part) >= 0 && parseInt(part) <= 255);
        }

        // 判断是否为IPv6地址的函数
        function isIPv6(ip) {
            if (!ip) return false;
            // 判断是否为IPv6（检查是否只包含合法字符）
            const ipv6Regex = /^[0-9a-fA-F:]+$/;
            if (ipv6Regex.test(ip)) {
                return true;
            }
            return false;
        }


        // 辅助函数：首字母大写
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }


        // 工具函数：格式化键名（首字母大写，下划线转空格）
        function formatKey(key) {
            return key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ');
        }


        // 工具函数：格式化值以便显示
        function formatValue(value) {
            if (value === null) return 'null';
            if (value === undefined) return 'undefined';

            // 处理日期对象
            if (value instanceof Date) {
                return value.toISOString();
            }

            // 处理数组和对象
            if (typeof value === 'object') {
                try {
                    // 尝试转换为格式化的JSON字符串
                    return JSON.stringify(value, null, 2);
                } catch (e) {
                    // 如果转换失败，使用默认toString
                    return value.toString();
                }
            }

            // 处理其他类型
            return value.toString();
        }



        // 辅助函数：提取JSONP内容
        function extractJsonpContent(jsonpString) {
            if (typeof jsonpString !== 'string') return null;

            // 更健壮的正则表达式，匹配各种JSONP格式
            const jsonpPattern = /^\s*(?:[a-zA-Z_$][\w$]*(?:\.[a-zA-Z_$][\w$]*)*\s*)?\(\s*([\s\S]*?)\s*\)\s*(?:;|$)/;
            const match = jsonpString.match(jsonpPattern);

            if (match && match[1]) {
                return match[1].trim();
            }

            return null;
        }


        // 辅助函数：获取嵌套对象的值（支持点表示法）
        function getNestedValue(obj, path) {
            if (!obj || typeof obj !== 'object') return null;

            // 如果路径是点分隔的，拆分为数组
            const pathArray = path.split('.');
            let current = obj;

            for (const key of pathArray) {
                if (current[key] === undefined) {
                    return null; // 路径不存在
                }
                current = current[key];
            }

            return current;
        }

        // 工具函数：通过ID生成相关元素ID
        function getElementIds(configId) {
            return {
                loadingIds: [`${configId}Ip`, `${configId}Ipv6`],
                resultElements: {
                    ipv4: `${configId}Ip`,
                    ipv6: `${configId}Ipv6`
                },
                detailsTableId: `${configId}DetailsTable`,
                detailsId: `${configId}Details`,
                detailsBtnId: `${configId}DetailsBtn`,
                btnTextId: `${configId}BtnText`,
                btnIconId: `${configId}BtnIcon`
            };
        }


        // 显示通知提示
        function showNotification(message, isSuccess = true) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const notificationIcon = document.getElementById('notificationIcon');


            notificationText.textContent = message;
            notificationIcon.className = `fa mr-2 ${isSuccess ? 'fa-check-circle text-secondary' : 'fa-exclamation-circle text-danger'}`;


            // 先隐藏再显示以重新触发动画
            notification.classList.add('hidden');
            setTimeout(() => {
                notification.classList.remove('hidden');
            }, 10);


            // 3秒后自动隐藏
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }


        // 复制到剪贴板功能
        function copyToClipboard(text) {
            // 跳过特殊状态文本
            if (text === '加载中...' || text === '获取失败' || text === '-' || text === '无数据' || text === '无IPv4地址' || text === '无IPv6地址') {
                showNotification('没有可复制的内容', false);
                return;
            }


            // 先尝试现代API
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text)
                    .then(() => showNotification('复制成功'))
                    .catch(() => {
                        // 现代API失败，使用传统方法
                        fallbackCopyText(text);
                    });
            } else {
                // 不支持现代API，直接使用传统方法
                fallbackCopyText(text);
            }
        }


        // 传统复制方法（使用 textarea 和 execCommand）
        function fallbackCopyText(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();


            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification('文本复制成功！');
                } else {
                    throw new Error('execCommand 复制失败');
                }
            } catch (err) {
                console.error('复制失败:', err);
                showNotification('复制失败，请手动复制', false);
            } finally {
                document.body.removeChild(textArea);
            }
        }

    </script>
<script src="/floating-ball/load-floating-ball.js"></script>
</body>
</html>

