<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OFDæ–‡ä»¶æŸ¥çœ‹å™¨</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- OFD.js - ä½¿ç”¨ç”¨æˆ·æä¾›çš„ç¤ºä¾‹ä¸­çš„bundleæ–‡ä»¶ -->
  <script src="ofd.bundle-v3.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            accent: '#0ea5e9',
            neutral: '#f1f5f9',
            'neutral-dark': '#334155',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .transition-all-300 {
        transition: all 300ms ease-in-out;
      }
      .scrollbar-thin {
        scrollbar-width: thin;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .bg-gradient-blue {
        background: linear-gradient(135deg, #3b82f6 0%, #0ea5e9 100%);
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header class="bg-white shadow-sm">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-file-text-o text-primary text-2xl"></i>
        <h1 class="text-xl font-bold text-gray-800">OFDæ–‡ä»¶æŸ¥çœ‹å™¨</h1>
      </div>
      <div class="flex items-center space-x-4">
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-all-300">
          <i class="fa fa-moon-o text-gray-600"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <main class="flex-grow container mx-auto px-4 py-6 flex flex-col lg:flex-row gap-6">
    <!-- å·¦ä¾§æ–‡ä»¶åˆ—è¡¨ -->
    <div class="lg:w-1/4 bg-white rounded-lg shadow-card p-4 flex flex-col">
      <div class="mb-4">
        <h2 class="text-lg font-semibold text-gray-800 mb-2">æ–‡ä»¶åˆ—è¡¨</h2>
        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary transition-all-300 cursor-pointer" id="drop-area">
          <i class="fa fa-cloud-upload text-3xl text-gray-400 mb-2"></i>
          <p class="text-sm text-gray-500">ç‚¹å‡»æˆ–æ‹–æ‹½OFDæ–‡ä»¶åˆ°æ­¤å¤„</p>
          <input type="file" id="file-input" class="hidden" accept=".ofd" multiple>
        </div>
      </div>

      <div class="flex-grow overflow-y-auto scrollbar-thin">
        <ul id="file-list" class="space-y-2">
          <!-- æ–‡ä»¶åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          <li class="text-gray-500 text-center italic py-4">æš‚æ— æ–‡ä»¶</li>
        </ul>
      </div>
    </div>

    <!-- å³ä¾§é¢„è§ˆåŒºåŸŸ -->
    <div class="lg:w-3/4 bg-white rounded-lg shadow-card p-4 flex flex-col">
      <div id="preview-header" class="mb-4 flex justify-between items-center">
        <h2 class="text-lg font-semibold text-gray-800" id="document-title">è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé¢„è§ˆ</h2>
        <div class="flex items-center space-x-2">
          <button id="zoom-out" class="p-2 rounded hover:bg-gray-100 transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fa fa-search-minus text-gray-600"></i>
          </button>
          <span id="zoom-level" class="text-sm text-gray-600">100%</span>
          <button id="zoom-in" class="p-2 rounded hover:bg-gray-100 transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fa fa-search-plus text-gray-600"></i>
          </button>
          <button id="download" class="p-2 rounded hover:bg-gray-100 transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fa fa-download text-gray-600"></i>
          </button>
          <button id="print-btn" class="p-2 rounded hover:bg-gray-100 transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fa fa-print text-gray-600"></i>
          </button>
        </div>
      </div>

      <div id="preview-loading" class="hidden flex-grow flex items-center justify-center">
        <div class="flex flex-col items-center">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
          <p class="mt-4 text-gray-600">æ­£åœ¨åŠ è½½æ–‡æ¡£...</p>
        </div>
      </div>

      <div id="preview-error" class="hidden flex-grow flex items-center justify-center">
        <div class="flex flex-col items-center text-center p-4">
          <i class="fa fa-exclamation-circle text-4xl text-red-500 mb-2"></i>
          <p class="text-red-500 font-medium">æ–‡æ¡£åŠ è½½å¤±è´¥</p>
          <p class="text-gray-600 mt-2" id="error-message">è¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸåæˆ–æ ¼å¼ä¸æ­£ç¡®</p>
        </div>
      </div>

      <div id="preview-content" class="flex-grow overflow-y-auto scrollbar-thin p-2 hidden flex flex-col items-center">
        <!-- æ–‡æ¡£å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </div>

      <div id="no-file-selected" class="flex-grow flex items-center justify-center">
        <div class="flex flex-col items-center text-center p-4">
          <i class="fa fa-file-o text-5xl text-gray-300 mb-4"></i>
          <p class="text-gray-500 text-lg">æœªé€‰æ‹©æ–‡ä»¶</p>
          <p class="text-gray-400 mt-2">è¯·ä»å·¦ä¾§é€‰æ‹©æˆ–ä¸Šä¼ ä¸€ä¸ªOFDæ–‡ä»¶</p>
        </div>
      </div>
    </div>
  </main>

  <!-- åº•éƒ¨ä¿¡æ¯ -->
  <footer class="bg-white shadow-sm mt-auto">
    <div class="container mx-auto px-4 py-4 text-center text-sm text-gray-500">
      <p>Â© 2025 OFDæ–‡ä»¶æŸ¥çœ‹å™¨ | ä½¿ç”¨ <a href="https://github.com/DLTech21/ofd.js" target="_blank" class="text-primary hover:underline">ofd.js</a> æ„å»º</p>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // å…¨å±€å˜é‡
      const fileInput = document.getElementById('file-input');
      const dropArea = document.getElementById('drop-area');
      const fileList = document.getElementById('file-list');
      const documentTitle = document.getElementById('document-title');
      const previewContent = document.getElementById('preview-content');
      const previewLoading = document.getElementById('preview-loading');
      const previewError = document.getElementById('preview-error');
      const noFileSelected = document.getElementById('no-file-selected');
      const errorMessage = document.getElementById('error-message');
      const zoomIn = document.getElementById('zoom-in');
      const zoomOut = document.getElementById('zoom-out');
      const zoomLevel = document.getElementById('zoom-level');
      const downloadBtn = document.getElementById('download');
      const printBtn = document.getElementById('print-btn'); // ğŸ‘ˆ æ–°å¢
      const themeToggle = document.getElementById('theme-toggle');

      // å­˜å‚¨å·²ä¸Šä¼ çš„æ–‡ä»¶
      let uploadedFiles = [];
      let currentFileIndex = -1;
      let currentZoom = 100;
      const minZoom = 50;
      const maxZoom = 200;
      const zoomStep = 10;

      // åˆå§‹åŒ–
      initFileUpload();
      initEventListeners();

      // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
      function initFileUpload() {
        // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
        dropArea.addEventListener('click', () => {
          fileInput.click();
        });

        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', handleFileSelect);

        // æ‹–æ”¾åŠŸèƒ½
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
          dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
          dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
          dropArea.classList.add('border-primary');
          dropArea.classList.add('bg-blue-50');
        }

        function unhighlight() {
          dropArea.classList.remove('border-primary');
          dropArea.classList.remove('bg-blue-50');
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
          const dt = e.dataTransfer;
          const files = dt.files;

          if (files.length > 0) {
            handleFiles(files);
          }
        }
      }

      // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
      function initEventListeners() {
        // ç¼©æ”¾æŒ‰é’®
        zoomIn.addEventListener('click', () => {
          changeZoom(currentZoom + zoomStep);
        });

        zoomOut.addEventListener('click', () => {
          changeZoom(currentZoom - zoomStep);
        });

        // ä¸‹è½½æŒ‰é’®
        downloadBtn.addEventListener('click', () => {
          if (currentFileIndex >= 0) {
            const file = uploadedFiles[currentFileIndex];
            const url = URL.createObjectURL(file);
            const a = document.createElement('a');
            a.href = url;
            a.download = file.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }
        });

        // æ‰“å°æŒ‰é’® ğŸ‘ˆ æ–°å¢
        printBtn.addEventListener('click', () => {
          if (currentFileIndex >= 0) {
            printOfdDocument();
          }
        });

        // ä¸»é¢˜åˆ‡æ¢
        themeToggle.addEventListener('click', toggleTheme);
      }

      // å¤„ç†æ–‡ä»¶é€‰æ‹©
      function handleFileSelect(e) {
        const files = e.target.files;
        if (files.length > 0) {
          handleFiles(files);
        }
      }

      // å¤„ç†æ–‡ä»¶
      function handleFiles(files) {
        // è¿‡æ»¤OFDæ–‡ä»¶
        const ofdFiles = Array.from(files).filter(file => file.name.endsWith('.ofd'));

        if (ofdFiles.length === 0) {
          showNotification('è¯·é€‰æ‹©OFDæ ¼å¼çš„æ–‡ä»¶', 'error');
          return;
        }

        // æ·»åŠ åˆ°ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
        ofdFiles.forEach(file => {
          // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæ–‡ä»¶
          const existingIndex = uploadedFiles.findIndex(f => f.name === file.name && f.size === file.size);
          if (existingIndex === -1) {
            uploadedFiles.push(file);
          }
        });

        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
        updateFileList();

        // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä¸Šä¼ æ–‡ä»¶ï¼Œè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ª
        if (currentFileIndex === -1 && uploadedFiles.length > 0) {
          selectFile(0);
        }

        // é‡ç½®æ–‡ä»¶è¾“å…¥
        fileInput.value = '';
      }

      // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
      function updateFileList() {
        if (uploadedFiles.length === 0) {
          fileList.innerHTML = '<li class="text-gray-500 text-center italic py-4">æš‚æ— æ–‡ä»¶</li>';
          return;
        }

        fileList.innerHTML = '';
        uploadedFiles.forEach((file, index) => {
          const li = document.createElement('li');
          li.className = `p-2 rounded flex items-center justify-between cursor-pointer transition-all-300 ${index === currentFileIndex ? 'bg-blue-50 text-primary' : 'hover:bg-gray-50'}`;
          li.innerHTML = `
            <div class="flex items-center truncate">
              <i class="fa fa-file-text-o mr-2"></i>
              <span class="truncate">${file.name}</span>
            </div>
            <button class="text-gray-400 hover:text-red-500 transition-all-300" data-index="${index}">
              <i class="fa fa-times"></i>
            </button>
          `;

          // ç‚¹å‡»æ–‡ä»¶é€‰æ‹©é¢„è§ˆ
          li.querySelector('.truncate').addEventListener('click', () => {
            selectFile(index);
          });

          // ç‚¹å‡»åˆ é™¤æŒ‰é’®
          li.querySelector('button').addEventListener('click', (e) => {
            e.stopPropagation();
            deleteFile(index);
          });

          fileList.appendChild(li);
        });
      }

      // é€‰æ‹©æ–‡ä»¶è¿›è¡Œé¢„è§ˆ
      function selectFile(index) {
        if (index < 0 || index >= uploadedFiles.length) return;

        currentFileIndex = index;
        const file = uploadedFiles[index];

        // æ›´æ–°UI
        documentTitle.textContent = file.name;
        updateFileList(); // æ›´æ–°é€‰ä¸­çŠ¶æ€

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        showLoading();

        // è§£æOFDæ–‡ä»¶
        parseOfdFile(file);
      }

      // åˆ é™¤æ–‡ä»¶
      function deleteFile(index) {
        if (index < 0 || index >= uploadedFiles.length) return;

        // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰æ­£åœ¨é¢„è§ˆçš„æ–‡ä»¶
        if (index === currentFileIndex) {
          // æ¸…ç©ºé¢„è§ˆ
          previewContent.innerHTML = '';
          documentTitle.textContent = 'è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé¢„è§ˆ';

          // ç¦ç”¨æŒ‰é’®
          disablePreviewControls();

          // æ˜¾ç¤ºæ— æ–‡ä»¶é€‰ä¸­çŠ¶æ€
          showNoFileSelected();

          // æ›´æ–°å½“å‰æ–‡ä»¶ç´¢å¼•
          if (uploadedFiles.length > 1) {
            currentFileIndex = index === 0 ? 0 : index - 1;
            selectFile(currentFileIndex);
          } else {
            currentFileIndex = -1;
          }
        } else if (index < currentFileIndex) {
          // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰æ–‡ä»¶ä¹‹å‰çš„æ–‡ä»¶ï¼Œæ›´æ–°ç´¢å¼•
          currentFileIndex--;
        }

        // ä»æ•°ç»„ä¸­åˆ é™¤æ–‡ä»¶
        uploadedFiles.splice(index, 1);

        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
        updateFileList();
      }

      // è§£æOFDæ–‡ä»¶
      function parseOfdFile(file) {
        try {
          // é‡ç½®ç¼©æ”¾
          currentZoom = 100;
          zoomLevel.textContent = '100%';

          // åˆ›å»ºFileReaderè¯»å–æ–‡ä»¶ä¸ºArrayBuffer
          const reader = new FileReader();
          reader.onload = function(e) {
            const arrayBuffer = e.target.result;

            // ç¡®ä¿ofdåº“å·²æ­£ç¡®åŠ è½½
            if (!window.ofd || typeof window.ofd.parseOfdDocument !== 'function') {
              showError('ofd.jsåº“æœªæ­£ç¡®åŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
              console.error('ofd.jsåº“æœªæ­£ç¡®åŠ è½½');
              return;
            }

            console.log('ä½¿ç”¨ofd.jsè§£ææ–‡ä»¶:', file.name);

            // è§£æOFDæ–‡ä»¶
            window.ofd.parseOfdDocument({
              ofd: arrayBuffer,
              success() {
                try {
                  console.log('âœ… è§£ææˆåŠŸï¼Œå¼€å§‹æ¸²æŸ“...');

                  // æ¸²æŸ“æ–‡æ¡£0çš„æ‰€æœ‰é¡µï¼Œå®½åº¦ä¸º800px
                  const divs = window.ofd.renderOfd(0, 800);

                  if (!divs || divs.length === 0) {
                    throw new Error('æ¸²æŸ“OFDæ–‡ä»¶å¤±è´¥ï¼Œæœªç”Ÿæˆä»»ä½•é¡µé¢');
                  }

                  // æ¸…ç©ºé¢„è§ˆåŒºåŸŸ
                  previewContent.innerHTML = '';

                  // æ·»åŠ æ‰€æœ‰é¡µé¢
                  divs.forEach(div => {
                    previewContent.appendChild(div);
                  });

                  // æ˜¾ç¤ºé¢„è§ˆå†…å®¹
                  showPreviewContent();

                  // å¯ç”¨æ§åˆ¶æŒ‰é’®
                  enablePreviewControls();
                } catch (renderError) {
                  console.error('âŒ æ¸²æŸ“å¤±è´¥:', renderError);
                  showError(`æ¸²æŸ“OFDæ–‡ä»¶å¤±è´¥: ${renderError.message || 'æœªçŸ¥é”™è¯¯'}`);
                }
              },
              fail(error) {
                console.error('âŒ è§£æå¤±è´¥:', error);
                showError(`è§£æOFDæ–‡ä»¶å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`);
              }
            });
          };

          reader.onerror = function() {
            showError('è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œè¯·å°è¯•å…¶ä»–æ–‡ä»¶');
            console.error('è¯»å–æ–‡ä»¶å¤±è´¥', reader.error);
          };

          // ä»¥ArrayBufferå½¢å¼è¯»å–æ–‡ä»¶
          reader.readAsArrayBuffer(file);
        } catch (error) {
          console.error('è§£æOFDæ–‡ä»¶å¤±è´¥:', error);
          showError(`è§£ææ–‡ä»¶å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}`);
        }
      }

      // æ”¹å˜ç¼©æ”¾çº§åˆ«
      function changeZoom(level) {
        if (level < minZoom || level > maxZoom) return;

        currentZoom = level;
        zoomLevel.textContent = `${currentZoom}%`;

        applyZoom();
      }

      // åº”ç”¨ç¼©æ”¾
      function applyZoom() {
        const scale = currentZoom / 100;

        // å¯¹æ¯ä¸ªé¡µé¢åº”ç”¨ç¼©æ”¾
        const pages = previewContent.querySelectorAll('div[class*="ofd-page"]') ||
                      previewContent.querySelectorAll('div');

        pages.forEach(page => {
          page.style.transform = `scale(${scale})`;
          page.style.transformOrigin = 'top left';
          page.style.marginBottom = `${20 * scale}px`;
        });

        // è°ƒæ•´å®¹å™¨å¤§å°ä»¥é€‚åº”ç¼©æ”¾åçš„å†…å®¹
        const containerWidth = 100 / scale;
        previewContent.style.width = `${containerWidth}%`;
      }

      // å¯ç”¨é¢„è§ˆæ§åˆ¶æŒ‰é’®
      function enablePreviewControls() {
        zoomIn.disabled = false;
        zoomOut.disabled = false;
        downloadBtn.disabled = false;
        printBtn.disabled = false; // ğŸ‘ˆ å¯ç”¨æ‰“å°æŒ‰é’®
        updateZoomButtonsState();
      }

      // ç¦ç”¨é¢„è§ˆæ§åˆ¶æŒ‰é’®
      function disablePreviewControls() {
        zoomIn.disabled = true;
        zoomOut.disabled = true;
        downloadBtn.disabled = true;
        printBtn.disabled = true; // ğŸ‘ˆ ç¦ç”¨æ‰“å°æŒ‰é’®
      }

      // æ›´æ–°ç¼©æ”¾æŒ‰é’®çŠ¶æ€
      function updateZoomButtonsState() {
        zoomOut.disabled = currentZoom <= minZoom;
        zoomIn.disabled = currentZoom >= maxZoom;
      }

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      function showLoading() {
        previewLoading.classList.remove('hidden');
        previewError.classList.add('hidden');
        previewContent.classList.add('hidden');
        noFileSelected.classList.add('hidden');
      }

      // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
      function showError(message) {
        errorMessage.textContent = message;
        previewLoading.classList.add('hidden');
        previewError.classList.remove('hidden');
        previewContent.classList.add('hidden');
        noFileSelected.classList.add('hidden');

        // ç¦ç”¨æ§åˆ¶æŒ‰é’®
        disablePreviewControls();
      }

      // æ˜¾ç¤ºé¢„è§ˆå†…å®¹
      function showPreviewContent() {
        previewLoading.classList.add('hidden');
        previewError.classList.add('hidden');
        previewContent.classList.remove('hidden');
        previewContent.classList.add('block');
        noFileSelected.classList.add('hidden');

        // åº”ç”¨å½“å‰ç¼©æ”¾
        applyZoom();
      }

      // æ˜¾ç¤ºæ— æ–‡ä»¶é€‰ä¸­çŠ¶æ€
      function showNoFileSelected() {
        previewLoading.classList.add('hidden');
        previewError.classList.add('hidden');
        previewContent.classList.add('hidden');
        noFileSelected.classList.remove('hidden');
      }

      // ä¸»é¢˜åˆ‡æ¢
      function toggleTheme() {
        document.body.classList.toggle('dark');

        const isDark = document.body.classList.contains('dark');
        themeToggle.innerHTML = isDark ?
          '<i class="fa fa-sun-o text-yellow-400"></i>' :
          '<i class="fa fa-moon-o text-gray-600"></i>';
      }

      // æ˜¾ç¤ºé€šçŸ¥
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed bottom-4 right-4 px-4 py-2 rounded shadow-lg z-50 transition-all-300 transform translate-y-0 opacity-100 ${
          type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'
        }`;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.classList.add('opacity-0', 'translate-y-4');
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, 3000);
      }

      // ğŸ‘‡ æ–°å¢ï¼šæ‰“å° OFD æ–‡æ¡£å‡½æ•°
      function printOfdDocument() {
        const content = previewContent.innerHTML;
        if (!content.trim()) {
          showNotification('æ— å¯æ‰“å°å†…å®¹', 'error');
          return;
        }

        const iframe = document.createElement('iframe');
        iframe.style.position = 'absolute';
        iframe.style.width = '0';
        iframe.style.height = '0';
        iframe.style.border = 'none';
        document.body.appendChild(iframe);

        const doc = iframe.contentWindow.document;
        doc.open();
        doc.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <title>æ‰“å° OFD æ–‡æ¡£</title>
            <style>
              body {
                margin: 0;
                padding: 0;
                font-family: sans-serif;
              }
              .ofd-page {
                page-break-after: always;
                break-after: page;
                transform: none !important;
                transform-origin: unset !important;
                margin: 0 !important;
                width: auto !important;
                max-width: 100% !important;
                height: auto !important;
                box-sizing: border-box;
              }
              @media print {
                body {
                  -webkit-print-color-adjust: exact;
                  print-color-adjust: exact;
                }
              }
            </style>
          </head>
          <body>
            ${content}
          </body>
          </html>
        `);
        doc.close();

        setTimeout(() => {
          iframe.contentWindow.focus();
          iframe.contentWindow.print();
          document.body.removeChild(iframe);
        }, 500);
      }
    });
  </script>
</body>
</html>
